{"version":3,"sources":["webpack:///./src/components/Search.js","webpack:///./src/pages/search.js"],"names":["Search","value","onChange","location","css","placeholder","onKeyPress","e","key","target","blur","onBlur","queryString","parseUrl","href","query","tag","trim","navigate","Divider","color","Wrapper","data","posts","allMarkdownRemark","edges","useState","filteredData","tags","state","setState","searchPost","useCallback","filter","post","searchQuery","toLowerCase","node","excerpt","frontmatter","title","includes","tagsData","result","map","i","length","j","splice","searchTags","useEffect","Layout","TagSelector","onTagClick","prev","index","Post"],"mappings":"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","file":"component---src-pages-search-js-8bfbd7de0af4977ba4df.js","sourcesContent":["import React from \"react\"\nimport tw from \"twin.macro\"\nimport queryString from \"query-string\"\nimport { AiOutlineSearch } from \"react-icons/ai\"\nimport Divider from \"./Divider\"\nimport { navigate } from \"gatsby\"\n\nconst Search = ({ value, onChange, location }) => {\n  const handlePress = (e) => {\n    if (e.key === \"Enter\") {\n      e.target.blur()\n    }\n  }\n\n  const handleBlur = (e) => {\n    const {\n      query: { query, tag },\n    } = queryString.parseUrl(location.href)\n    if (query !== value.trim())\n      if (tag && tag !== \"ALL\") {\n        navigate(`?query=${value.trim()}&tag=${tag}`)\n      } else {\n        navigate(`?query=${value.trim()}`)\n      }\n  }\n\n  return (\n    <>\n      <div css={tw`my-4 p-4 w-full`}>\n        <div css={tw`flex mb-2`}>\n          <AiOutlineSearch css={tw`text-gray-500 my-auto w-8 h-8`} />\n          <input\n            css={tw`appearance-none focus:outline-none w-full ml-2 bg-transparent placeholder-gray-600`}\n            placeholder={\"검색어를 입력해주세요.\"}\n            value={value}\n            onChange={onChange}\n            onKeyPress={handlePress}\n            onBlur={handleBlur}\n          />\n        </div>\n        <Divider color />\n      </div>\n    </>\n  )\n}\n\nexport default Search\n","import React, { useState, useEffect, useCallback } from \"react\"\nimport tw from \"twin.macro\"\nimport SEO from \"../components/seo\"\nimport Layout from \"../components/Layout\"\nimport { graphql } from \"gatsby\"\nimport queryString from \"query-string\"\nimport Search from \"../components/Search\"\nimport Post from \"../components/Post\"\nimport TagSelector from \"../components/TagSelector\"\n\nconst Wrapper = tw.div`w-full max-w-screen-md mx-auto`\n\nexport default ({ data, location }) => {\n  const posts = data.allMarkdownRemark.edges ? data.allMarkdownRemark.edges : []\n\n  const [state, setState] = useState({\n    query: \"\",\n    tag: \"ALL\",\n    filteredData: [],\n    tags: [],\n  })\n\n  const onTagClick = (tag) => {\n    setState((prev) => {\n      const filteredData = prev.filteredData.filter((post) => {\n        const {\n          excerpt,\n          frontmatter: { title, tags },\n        } = post.node\n        if (tags.includes(tag)) return (excerpt && excerpt) || (title && title)\n        return []\n      })\n      return {\n        ...prev,\n        tag: tag,\n        filteredData: filteredData,\n      }\n    })\n  }\n\n  const handleChange = (query) => {\n    if (query.trim() === state.query.trim()) {\n      setState({\n        ...state,\n        query,\n      })\n      return\n    }\n    searchPost(query, \"ALL\")\n  }\n\n  const searchPost = useCallback(\n    (query, tag) => {\n      if (query.trim() === \"\") {\n        setState({\n          query,\n          tag,\n          filteredData: [],\n          tags: [],\n        })\n        return\n      }\n\n      const filteredData = posts.filter((post) => {\n        const searchQuery = query.toLowerCase().trim()\n        const {\n          excerpt,\n          frontmatter: { title, tags },\n        } = post.node\n        return (\n          (excerpt && excerpt.toLowerCase().includes(searchQuery)) ||\n          (title && title.toLowerCase().includes(searchQuery)) ||\n          (tags && tags.includes(searchQuery))\n        )\n      })\n\n      const searchTags = (filteredData) => {\n        var result = []\n        filteredData.map(\n          ({ node }) => (result = [...result, ...node.frontmatter.tags])\n        )\n        for (var i = 0; i < result.length; ++i) {\n          for (var j = i + 1; j < result.length; ++j) {\n            if (result[i] === result[j]) result.splice(j--, 1)\n          }\n        }\n        return result\n      }\n\n      setState(() => {\n        const tagsData = searchTags(filteredData)\n        return {\n          tag: tag,\n          query: query,\n          filteredData: filteredData,\n          tags: tagsData,\n        }\n      })\n    },\n    [posts]\n  )\n\n  useEffect(() => {\n    if (location.href) {\n      const {\n        query: { query, tag },\n      } = queryString.parseUrl(location.href)\n      searchPost(query ? query : \"\", tag ? tag : \"ALL\")\n    }\n  }, [searchPost, location.href])\n\n  return (\n    <Layout>\n      <SEO title=\"Search\" />\n      <Wrapper>\n        <Search\n          value={state.query}\n          onChange={(e) => handleChange(e.target.value)}\n          location={location}\n        />\n        <TagSelector tags={state.tags} onTagClick={onTagClick} state={state} />\n        {state.filteredData.map((post, index) => (\n          <Post post={post} key={`post_${index}`} />\n        ))}\n      </Wrapper>\n    </Layout>\n  )\n}\n\nexport const pageQuery = graphql`\n  query {\n    allMarkdownRemark(\n      sort: { fields: [frontmatter___date], order: DESC }\n      filter: { frontmatter: { draft: { eq: false } } }\n    ) {\n      edges {\n        node {\n          excerpt(pruneLength: 200, truncate: true)\n          fields {\n            slug\n          }\n          frontmatter {\n            date(formatString: \"YYYY년 MM월 DD일\")\n            title\n            tags\n          }\n        }\n      }\n    }\n  }\n`\n"],"sourceRoot":""}