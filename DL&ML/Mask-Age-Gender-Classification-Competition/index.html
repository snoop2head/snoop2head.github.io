<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0"/><style data-href="/styles.d53766664f3eaba3db40.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}</style><meta name="generator" content="Gatsby 2.32.13"/><style type="text/css">
    .toc-header.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .toc-header.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .toc-header svg,
    h2 .toc-header svg,
    h3 .toc-header svg,
    h4 .toc-header svg,
    h5 .toc-header svg,
    h6 .toc-header svg {
      visibility: hidden;
    }
    h1:hover .toc-header svg,
    h2:hover .toc-header svg,
    h3:hover .toc-header svg,
    h4:hover .toc-header svg,
    h5:hover .toc-header svg,
    h6:hover .toc-header svg,
    h1 .toc-header:focus svg,
    h2 .toc-header:focus svg,
    h3 .toc-header:focus svg,
    h4 .toc-header:focus svg,
    h5 .toc-header:focus svg,
    h6 .toc-header:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32-1c5857f550ca5d27138682501fbd1e0a.png" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3F4145"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512-1c5857f550ca5d27138682501fbd1e0a.png"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Multiclass Classification Competition Wrap up report | snoop2head&#x27;s blog</title><meta data-react-helmet="true" name="description" content="Result âœ¨ Individual Rank: 32nd / 250 participants ðŸ¥‰ Team Rank: 11th / 38 teams Task Description Competition participants should identify 18 classes correctly and competition grading criteria is basedâ€¦"/><meta data-react-helmet="true" property="og:title" content="Multiclass Classification Competition Wrap up report"/><meta data-react-helmet="true" property="og:image" content="/static/social-image-a1864c5d52ffceef83c1d6baedf4493b.png"/><meta data-react-helmet="true" property="og:description" content="Result âœ¨ Individual Rank: 32nd / 250 participants ðŸ¥‰ Team Rank: 11th / 38 teams Task Description Competition participants should identify 18 classes correctly and competition grading criteria is basedâ€¦"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image" content="/static/social-image-a1864c5d52ffceef83c1d6baedf4493b.png"/><meta data-react-helmet="true" name="twitter:creator" content="Young Jin Ahn"/><meta data-react-helmet="true" name="twitter:title" content="Multiclass Classification Competition Wrap up report"/><meta data-react-helmet="true" name="twitter:description" content="Result âœ¨ Individual Rank: 32nd / 250 participants ðŸ¥‰ Team Rank: 11th / 38 teams Task Description Competition participants should identify 18 classes correctly and competition grading criteria is basedâ€¦"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-2d2e6eca74f66222a671.js"/><link as="script" rel="preload" href="/framework-c8d3a5345e3f321d7da5.js"/><link as="script" rel="preload" href="/styles-e8fd4555a67a3390b64e.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-4121d07143daec1f6e61.js"/><link as="script" rel="preload" href="/app-6b37a0275bc86b56e034.js"/><link as="script" rel="preload" href="/d7eeaac4-dcbe97e7a5aa158c9d08.js"/><link as="script" rel="preload" href="/5e2a4920-da90abce4a08c86a094c.js"/><link as="script" rel="preload" href="/1bfc9850-103202d7f810115a42e7.js"/><link as="script" rel="preload" href="/commons-33df4d3f9aa201d0ec4c.js"/><link as="script" rel="preload" href="/b1bda0e5b3305dd279ac60c39e10b0f82af56c10-cca622a04473b7e5e8b2.js"/><link as="script" rel="preload" href="/7a297f752dcfe258c0b0106d89edb3a916af916e-d921dc7587d10ed55da7.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-5f317a7779dd1baa19f9.js"/><link as="fetch" rel="preload" href="/page-data/DL&amp;ML/Mask-Age-Gender-Classification-Competition/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1081905842.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3911196313.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><style data-emotion-css="1vyo7ug">.css-1vyo7ug{position:fixed;bottom:0;left:0;margin-left:0.5rem;margin-bottom:0.5rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;box-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));font-size:0.875rem;font-weight:700;padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:0.75rem;background-color:#86a8e7;z-index:9999;}</style><div class="css-1vyo7ug"><style data-emotion-css="5x4yj0">.css-5x4yj0{fill:currentColor;width:1.5rem;height:1.5rem;margin-right:0.5rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" class="css-5x4yj0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg><style data-emotion-css="1f2k2gl">.css-1f2k2gl{margin-left:0.5rem;}</style><div class="css-1f2k2gl">Please enable JavaScript to use this site.<br/>JavaScriptë¥¼ í™œì„±í™” ì‹œì¼œì£¼ì„¸ìš”.</div></div></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="f6s0ma">.css-f6s0ma{-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#333333;}</style><style data-emotion-css="acifd">.css-acifd{min-height:100vh;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#333333;}</style><div class="css-acifd e60ayux0"><style data-emotion-css="8ezs2g">.css-8ezs2g{min-height:calc(100vh - 100px);}</style><div class="css-8ezs2g"><style data-emotion-css="1yxw6gp">.css-1yxw6gp{background:linear-gradient( 90deg,#7f7fd5,#86a8e7 );}</style><div class="css-1yxw6gp"><style data-emotion-css="1mqm4zt">.css-1mqm4zt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;max-width:1280px;margin-left:auto;margin-right:auto;padding:1.25rem;}</style><nav class="css-1mqm4zt e1czdvww0"><style data-emotion-css="1usmgm5">.css-1usmgm5{font-size:1.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));font-weight:700;}</style><a class="css-1usmgm5" href="/">Young Jin Ahn&#x27;s Blog</a><a aria-label="search page" href="/search"><style data-emotion-css="47445j">.css-47445j{--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));margin-top:auto;margin-bottom:auto;width:2rem;height:2rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-47445j" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></a></nav></div><style data-emotion-css="aod07n">.css-aod07n{background:linear-gradient( 90deg,#7f7fd5,#86a8e7 );position:fixed;width:100%;box-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);z-index:100;-webkit-transition:all 300ms cubic-bezier(0,0,0.2,1);transition:all 300ms cubic-bezier(0,0,0.2,1);top:-100px;}</style><div class="css-aod07n"><nav class="css-1mqm4zt e1czdvww0"><a class="css-1usmgm5" href="/">Young Jin Ahn&#x27;s Blog</a><a aria-label="search page" href="/search"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-47445j" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></a></nav></div><style data-emotion-css="w27u98">.css-w27u98{margin-top:1rem;padding-left:1rem;padding-right:1rem;}</style><div class="blog-post-container css-w27u98"><div class="blog-post"><style data-emotion-css="1bdwg0l">.css-1bdwg0l{width:100%;max-width:768px;margin-left:auto;margin-right:auto;}</style><div class="css-1bdwg0l eyldt480"><style data-emotion-css="1abxlfd">.css-1abxlfd{font-size:2.25rem;font-weight:700;margin-bottom:1rem;}@media (min-width:768px){.css-1abxlfd{font-size:3rem;}}</style><h1 class="blog-title css-1abxlfd">Multiclass Classification Competition Wrap up report</h1><style data-emotion-css="cpn9zx">.css-cpn9zx{font-size:1rem;margin-bottom:1rem;}</style><h2 class="blog-date css-cpn9zx">2021-09-04</h2><style data-emotion-css="cet0rr">.css-cet0rr{margin-bottom:0.5rem;}</style><div class="blog-tags css-cet0rr"><style data-emotion-css="1ak4bcm">.css-1ak4bcm{white-space:nowrap;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);font-size:1rem;font-weight:700;border-radius:9999px;margin-right:0.5rem;margin-top:0.25rem;margin-bottom:0.25rem;padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#edf2f7;color:#3737B9;}</style><button class="css-1ak4bcm">ComputerVision</button><button class="css-1ak4bcm">Competition</button></div><style data-emotion-css="1l4w6pd">.css-1l4w6pd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div class="css-1l4w6pd"><style data-emotion-css="yapsbb">.css-yapsbb{border-radius:9999px;width:100%;height:1px;--bg-opacity:1;background-color:rgba(247,250,252,var(--bg-opacity));background:linear-gradient( 270deg,#7f7fd5,#86a8e7,#91eac9 );}</style><div class="css-yapsbb"></div></div></div><div class="blog-content"><style data-emotion-css="19vk1qv">.css-19vk1qv{-webkit-scrollbar-width:thin;-moz-scrollbar-width:thin;-ms-scrollbar-width:thin;scrollbar-width:thin;-webkit-scrollbar-color:gray transparent;-moz-scrollbar-color:gray transparent;-ms-scrollbar-color:gray transparent;scrollbar-color:gray transparent;display:none;}.css-19vk1qv::-webkit-scrollbar{width:4px;}.css-19vk1qv::-webkit-scrollbar-track{background-color:transparent;}.css-19vk1qv::-webkit-scrollbar-thumb{border-radius:9999px;background-color:gray;}.css-19vk1qv::-webkit-scrollbar-button{width:0;height:0;}@media screen and (min-width:1280px){.css-19vk1qv{float:right;position:-webkit-sticky;position:sticky;top:100px;width:calc((100vw - 720px) / 2 - 80px);max-width:250px;margin-right:1rem;overflow:auto;word-break:break-word;max-height:calc(100vh - 200px);fontsize:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-left-width:4px;border-image:linear-gradient( 180deg,#7f7fd5,#86a8e7,#91eac9 );border-image-slice:1;}}</style><div class="css-19vk1qv"><style data-emotion-css="13af3fo">.css-13af3fo{margin-left:1rem;margin-right:1rem;}</style><div class="css-13af3fo"><style data-emotion-css="17i5xbf">.css-17i5xbf{font-weight:700;margin-bottom:0.5rem;font-size:1.125rem;--text-opacity:1;color:rgba(74,85,104,var(--text-opacity));}</style><h3 class="css-17i5xbf">TOC</h3><style data-emotion-css="1me4zjn">.css-1me4zjn ul{margin-left:0.5rem;}.css-1me4zjn ul > li a:hover{color:#555555;}.css-1me4zjn ul > li a{-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);--text-opacity:1;color:rgba(160,174,192,var(--text-opacity));font-size:0.875rem;}.css-1me4zjn ul > li a[href=""]{font-size:0.95rem;color:#555555;}</style><div class="css-1me4zjn"><ul>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#result">Result</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#task-description">Task Description</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#development-environment-settings">Development Environment Settings</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#choosing-and-comparing-model">Choosing and Comparing Model</a></li>
<li>
<p><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#how-to-resolve-the-class-imbalance-of-train-dataset">How to resolve the Class Imbalance of train dataset</a></p>
<ul>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#choosing-loss-for-the-class-imbalance">Choosing Loss for the Class Imbalance</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#adding-dataset-to-resolve-class-imbalance">Adding Dataset to resolve class imbalance</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#oversampling-to-alleviate-class-imbalance">Oversampling to Alleviate Class Imbalance.</a></li>
</ul>
</li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#cropping-face-to-reduce-noise">Cropping face to reduce noise</a></li>
<li>
<p><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#other-teammates-ideas--contributions">Other teammate's ideas &#x26; contributions</a></p>
<ul>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#1-applying-stratified-k-fold">1. Applying Stratified K-fold</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#2-applying-out-of-fold-ensemble">2. Applying Out-of-fold Ensemble</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#3-applying-multihead-modeling">3. Applying Multihead Modeling</a></li>
</ul>
</li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#other-insights">Other insights</a></li>
<li><a href="/DL&#x26;ML/Mask-Age-Gender-Classification-Competition/#should-have">Should have?</a></li>
</ul></div></div></div><div class="css-1bdwg0l eyldt480"><div><style data-emotion-css="c0q8g3">.css-c0q8g3{font-size:1rem;word-break:break-word;}.css-c0q8g3 h1 > a > svg,.css-c0q8g3 h2 > a > svg,.css-c0q8g3 h3 > a > svg,.css-c0q8g3 h4 > a > svg,.css-c0q8g3 h5 > a > svg,.css-c0q8g3 h6 > a > svg{fill:#000;}.css-c0q8g3 h1,.css-c0q8g3 h2{font-size:1.25rem;font-weight:600;margin-top:1.5rem;margin-bottom:1.5rem;}.css-c0q8g3 h3,.css-c0q8g3 h4,.css-c0q8g3 h5,.css-c0q8g3 h6{font-size:1.125rem;margin-top:1.5rem;margin-bottom:1.5rem;font-weight:600;}@media (min-width:640px){.css-c0q8g3 h1,.css-c0q8g3 h2{font-size:1.5rem;}.css-c0q8g3 h3,.css-c0q8g3 h4,.css-c0q8g3 h5,.css-c0q8g3 h6{font-size:1.25rem;}}.css-c0q8g3 a{color:#3737B9;}.css-c0q8g3 a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-c0q8g3 p{margin:0.3rem;margin-top:0.75rem;margin-bottom:0.75rem;}.css-c0q8g3 ul,.css-c0q8g3 ol{margin:0.3rem;margin-left:2rem;}.css-c0q8g3 li > p,.css-c0q8g3 li > ul,.css-c0q8g3 li > ol{margin-bottom:0;}.css-c0q8g3 ol{list-style-type:decimal;}.css-c0q8g3 ul{list-style-type:disc;}.css-c0q8g3 blockquote{padding:0.5rem;background-color:#eee;margin:0.3rem;margin-top:0.5rem;margin-bottom:0.5rem;border-left-width:4px;border-color:#86a8e7;}.css-c0q8g3 blockquote > p{margin:0.5rem;}.css-c0q8g3 blockquote > h1,.css-c0q8g3 blockquote > h2,.css-c0q8g3 blockquote > h3,.css-c0q8g3 blockquote > h4,.css-c0q8g3 blockquote > h5{margin-top:0.5rem;margin-bottom:0.5rem;}.css-c0q8g3 td,.css-c0q8g3 th{padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-width:1px;border-color:#86a8e7;}.css-c0q8g3 tr:nth-of-type(even){background-color:#eee;}.css-c0q8g3 th{background-color:#eee;}.css-c0q8g3 table{margin-bottom:1.5rem;display:block;max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;margin:0 auto;overflow-x:auto;white-space:nowrap;}.css-c0q8g3 p > code,.css-c0q8g3 li > code{padding-top:0.1rem;padding-bottom:0.1rem;padding-right:0.25rem;padding-left:0.25rem;border-radius:0.25rem;color:#3737B9;background-color:#eee;white-space:pre-line;}.css-c0q8g3 pre.grvsc-container{margin-top:24px;margin-bottom:24px;}.css-c0q8g3 hr{margin-top:24px;margin-bottom:24px;height:2px;border:none;background:linear-gradient( 270deg,#7f7fd5,#86a8e7,#91eac9 );}</style><div class="markdown css-c0q8g3"><h2 id="result" style="position:relative;"><a href="#result" aria-label="result permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Result</h2>
<ul>
<li>âœ¨ Individual Rank: 32nd / 250 participants</li>
<li>ðŸ¥‰ Team Rank: 11th / 38 teams</li>
</ul>
<h2 id="task-description" style="position:relative;"><a href="#task-description" aria-label="task description permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Task Description</h2>
<p><strong>Competition participants should identify 18 classes correctly and competition grading criteria is based on F1 Score.</strong></p>
<p>Goal is to classify Age Range, Biological Sex, Face Mask</p>
<ul>
<li>There are 3 classes for the Age Range: Lower than 30, Between 30 and 59, Above 60.</li>
<li>Biological Sex class is consisted of 2 classes which are Male and Female.</li>
<li>Thera are 3 classes for Face Mask which are: Wear, Incorrectly Wear, Not wear.</li>
</ul>
<h2 id="development-environment-settings" style="position:relative;"><a href="#development-environment-settings" aria-label="development environment settings permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Development Environment Settings</h2>
<ul>
<li>
<p><strong>Had consistent CUDA error on Upstage server which remained unsolved until the end.</strong></p>
<ul>
<li>This was <a href="https://nbviewer.jupyter.org/github/snoop2head/debugging-practice/blob/main/baseline_mask_cpu.ipynb">CNN Model that works on CPU Device on provided Upstage server</a>.</li>
<li>But 4 types of error arose when the same model &#x26; code was run on GPU Device. Sometimes the error occurred on fully connected layer(fc1), but other times the error occurred on convolutional layer(conv2).</li>
<li>ðŸ”— <a href="https://github.com/snoop2head/debugging-practice/blob/main/baseline_mask_gpu_ILLEGAL.ipynb">CUDA error: an illegal instruction</a></li>
<li>ðŸ”— <a href="https://github.com/snoop2head/debugging-practice/blob/main/baseline_mask_gpu_CUBLAS_STATUS_ALLOC_FAILED.ipynb">CUBLAS<em>STATUS</em>ALLOC_FAILED</a></li>
<li>ðŸ”— <a href="https://github.com/snoop2head/debugging-practice/blob/main/baseline_mask_gpu_CUDNN_STATUS_MAPPING_ERROR.ipynb">CUDNN<em>STATUS</em>MAPPING_ERROR</a></li>
<li>ðŸ”— <a href="https://github.com/snoop2head/debugging-practice/blob/main/baseline_mask_gpu_CUBLAS_STATUS_EXECUTION_FAILED.ipynb">CUBLAS<em>STATUS</em>EXECUTION_FAILED</a></li>
<li>After debugging for two days, I decided to proceed the competition on Colab Pro + account.</li>
</ul>
</li>
</ul>
<h2 id="choosing-and-comparing-model" style="position:relative;"><a href="#choosing-and-comparing-model" aria-label="choosing and comparing model permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choosing and Comparing Model</h2>
<ul>
<li>I focused on my role to provide backbone code that could be experimented by other teammates.</li>
<li>Thus minimum amount of albumentation/transformation was applied, whereas different types of models were alternated one by one.</li>
<li>From torchvision library and timm library, model performance SOTA models were compared for the competition's dataset.</li>
<li>It is proved that tf<em>efficientnet</em>b4 from the timm library was the most adaquate model for the competition.</li>
<li>For the comparison purpose, the hyperparameters, optimizers, train vs valid split ratio were not differentiated according to the models.</li>
<li><strong>The table was provided in form of Google Spreadsheet to my teammates so that they can compare models according to Eval F1 score or Validation F1 score.</strong></li>
<li>Furthermore it showed that setting more than 10 epochs did improve train accuracy and validation accuracy, but didn't improve the model's performance in terms of Eval F1 score.</li>
</ul>
<table>
<thead>
<tr>
<th>Eval F1</th>
<th>Valid F1</th>
<th>Pretrained Model</th>
<th>Train Albumentation</th>
<th>Valid Albumentation</th>
<th>Test Albumentation</th>
<th>Class Division</th>
<th>Train: Valid Split Ratio</th>
<th>Train Batch Size</th>
<th>Epoch</th>
<th>Learning Rate</th>
<th>Weight Decay</th>
<th>Criterion (Loss)</th>
<th>Optimizer</th>
<th>Scheduler</th>
<th>Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.7111</td>
<td>0.9279</td>
<td>tf<em>efficientnet</em>b4</td>
<td>Resize(height = 260, width = 200, p=1.0), HorizontalFlip(p=0.5), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize(height = 260, width = 200, p=1.0), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize((260,200), Image.BILINEAR), ToTensor(), transforms.Normalize(mean=(0.53087462, 0.45734182, 0.42477556), std=(0.23390616, 0.2311533, 0.23603857)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>32</td>
<td>9</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/31</td>
</tr>
<tr>
<td>0.6975</td>
<td>0.8737</td>
<td>tf<em>efficientnet</em>b3</td>
<td>Resize(height = 260, width = 200, p=1.0), HorizontalFlip(p=0.5), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize(height = 260, width = 200, p=1.0), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize((260,200), Image.BILINEAR), ToTensor(), transforms.Normalize(mean=(0.53087462, 0.45734182, 0.42477556), std=(0.23390616, 0.2311533, 0.23603857)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>32</td>
<td>9</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/31</td>
</tr>
<tr>
<td>0.7119</td>
<td>0.9162</td>
<td>tf<em>efficientnet</em>b4</td>
<td>Resize(height = 350, width = 350, p=1.0), HorizontalFlip(p=0.5), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize(height = 350, width = 350, p=1.0), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize((350,350), Image.BILINEAR), ToTensor(), transforms.Normalize(mean=(0.51573701, 0.46091698, 0.43106825), std=(0.23412625, 0.23709222, 0.24571251))</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>8</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/30</td>
</tr>
<tr>
<td>0.6028</td>
<td>0.8756</td>
<td>tf<em>efficientnet</em>b4</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize((512, 384), Image.BILINEAR), transforms.CenterCrop(height = 350, width = 350), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>10</td>
<td>1e-1</td>
<td>1e-5</td>
<td>FocalLoss(gamma = 5)</td>
<td>SGDP</td>
<td>MultiStepLR</td>
<td>2021/08/29</td>
</tr>
<tr>
<td>0.7197</td>
<td>0.8949</td>
<td>tf<em>efficientnet</em>b4</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize((512, 384), Image.BILINEAR), transforms.CenterCrop(height = 350, width = 350), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>4</td>
<td>1e-1</td>
<td>1e-5</td>
<td>FocalLoss(gamma = 5)</td>
<td>SGDP</td>
<td>MultiStepLR</td>
<td>2021/08/29</td>
</tr>
<tr>
<td><strong>0.7260</strong></td>
<td><strong>0.8903</strong></td>
<td><strong>tf<em>efficientnet</em>b4</strong></td>
<td><strong>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</strong></td>
<td><strong>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</strong></td>
<td><strong>Resize((512, 384), Image.BILINEAR), transforms.CenterCrop(height = 350, width = 350), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)),</strong></td>
<td><strong>18</strong></td>
<td><strong>0.9 : 0.1</strong></td>
<td><strong>16</strong></td>
<td><strong>10</strong></td>
<td><strong>3e-4</strong></td>
<td><strong>1e-2</strong></td>
<td><strong>FocalLoss(gamma = 5)</strong></td>
<td><strong>AdamP</strong></td>
<td><strong>MultiStepLR</strong></td>
<td><strong>2021/08/27</strong></td>
</tr>
<tr>
<td>0.7259</td>
<td>0.903</td>
<td>tf<em>efficientnet</em>b4</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize((512, 384), Image.BILINEAR), transforms.CenterCrop(height = 350, width = 350), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>17</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/28</td>
</tr>
<tr>
<td>0.7170</td>
<td>0.886</td>
<td>resnext50_32x4d</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize((512, 384), Image.BILINEAR), transforms.CenterCrop(height = 350, width = 350), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>32</td>
<td>10</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/26</td>
</tr>
<tr>
<td>0.6870</td>
<td>0.8922</td>
<td>vit<em>base</em>patch16_384</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 384, width = 384), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 384, width = 384), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>transforms.Compose([ Resize((512, 384), Image.BILINEAR), transforms.CenterCrop((384,384)), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)), ])</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>10</td>
<td>1e-4</td>
<td>1e-6</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/26</td>
</tr>
<tr>
<td>0.6820</td>
<td>0.896</td>
<td>vit<em>large</em>patch32<em>224</em>in21k</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height =224, width = 224), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height =224, width = 224), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>transforms.Compose([ Resize((512, 384), Image.BILINEAR), transforms.CenterCrop((224,224)), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)), ])</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>3</td>
<td>1e-4</td>
<td>1e-6</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/27</td>
</tr>
<tr>
<td>0.6730</td>
<td>0.856</td>
<td>resnet50</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0)</td>
<td>Resize((512, 384), Image.BILINEAR), transforms.CenterCrop(height = 350, width = 350), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)),</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>32</td>
<td>10</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/26</td>
</tr>
<tr>
<td>0.4423</td>
<td>0.8583</td>
<td>vit<em>base</em>patch16_384</td>
<td>Resize(img<em>size[0], img</em>size[1], p=1.0), CenterCrop(height = 350, width = 350), Resize(384, 384, p=1.0), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>Resize(img<em>size[0], img</em>size[1]), CenterCrop(height = 350, width = 350), # add centercrop Resize(384, 384, p=1.0), Normalize(mean=mean, std=std, max<em>pixel</em>value=255.0, p=1.0), ToTensorV2(p=1.0),</td>
<td>transforms.Compose([ Resize((512, 384), Image.BILINEAR), transforms.CenterCrop((350,350)), Resize((384, 384), Image.BILINEAR), ToTensor(), transforms.Normalize((0.56019358, 0.52410121, 0.501457), (0.23318603, 0.24300033, 0.24567522)), ])</td>
<td>18</td>
<td>0.9 : 0.1</td>
<td>16</td>
<td>10</td>
<td>3e-4</td>
<td>1e-2</td>
<td>FocalLoss(gamma = 5)</td>
<td>AdamP</td>
<td>MultiStepLR</td>
<td>2021/08/27</td>
</tr>
<tr>
<td>0.0550</td>
<td>0.99 0.92 0.95</td>
<td>resnet50</td>
<td>transforms.RandomResizedCrop(224), transforms.RandomHorizontalFlip(), transforms.ToTensor(), transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])</td>
<td>transforms.RandomResizedCrop(224), transforms.RandomHorizontalFlip(), transforms.ToTensor(), transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])</td>
<td>transforms.Resize(256), transforms.CenterCrop(224), transforms.ToTensor(), transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])</td>
<td>3 x 3 x 2</td>
<td>0.6 : 0.2 : 0.2</td>
<td>256</td>
<td>10</td>
<td>1e-4</td>
<td>-</td>
<td>CrossEntropyLoss</td>
<td>Adam</td>
<td>StepLR</td>
<td>2021/08/25</td>
</tr>
</tbody>
</table>
<h2 id="how-to-resolve-the-class-imbalance-of-train-dataset" style="position:relative;"><a href="#how-to-resolve-the-class-imbalance-of-train-dataset" aria-label="how to resolve the class imbalance of train dataset permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to resolve the Class Imbalance of train dataset</h2>
<ul>
<li>Females outnumbered males (1700 females vs 1000 males)</li>
<li>There were 200 individuals that were Age of 60 out of total 2700 individuals. They were the only individuals that consisted of the Class 60 and Above.</li>
</ul>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 392px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACrElEQVQ4y52S308TQRDHN/jryQcSE1/8ByQaQ4zxwaiR+MJ/YER8kISoSMQYUIPE6IOGqCQmBolgBIwJgmi0gmhEbQWsvdJS5EcJFSht73oUilTa3u3e7bh718Mi6oObTGZ3Zu4z39lbhBDKbWho2DU/P18my/Kp/7G5ubmToihWjIyM7GQ8lONyuUowxkAIAU0jYB+Pwjd5CYBqgDEx4v8yTdNAURSIRCKVHLjO5/MdAXMpzPAzTxiPiQnM95QZ/MWycild14GpLePADU6n8zilFJjpLElfeiMwLi0ZHXQzvsasRc0D4Sqj0Wi5oVAQhOJMkQG0DUXALyVWgNnLgiXSGCaiCZ5fA9zk9XqLzM4m8Kk7BGPiaoUWzGoQXEhCuzALmhkgJAu42ePxFFkKCato7p8GTzC+SqEF1XXTi4sp6BwMrSjMBm7kwMyH+rJCaJtrFlxTCyug3+8uqRJ4Py7DY2fwjwrXud3uY5bC+LJq3GHfZAxSWFsFtdTxXP2HAHQIIX6XJpD8Aq63gKybFk+qtOerRJscU3QgEOPFlKvIjEYxO/RPxvi10BfeMJWX0jyO+XtkwDOGwkE2Mu/MxoVlVYO3o1FodEyBfSK25i/3ZkZt/TwD3cMSxH4oTAho/MVZCnPcgnA0pWCQvqfSrBPu8kWUJnsAdw2F8Ue/rNj9EnH4ZbXbF1GffJnBrf3TysNPAWIbCqtJBavSYjKdSqsgiaLxsHOvVF/aevv+o721dXcOhIPTeaVV1w5V1jXvLr/Zkl9YUlVQ3vhue2Fp9cETV+v3XLzbll98tqbgVocj7/Tl2v2tLc37euzOHRU11w+/6bJt4UB04fw5FIhjxCZCLueA4e+99qIbzwXUvgCosnOUl23j8ZoHr4x8dX07CjHP97bePsNPjA6jn9c4lO8+SRmHAAAAAElFTkSuQmCC'); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="image" title="image" src="/static/5ec3ce265f2bcb5355566e8dca24bd19/0acb4/Untitled.png" srcset="/static/5ec3ce265f2bcb5355566e8dca24bd19/5a46d/Untitled.png 300w,
/static/5ec3ce265f2bcb5355566e8dca24bd19/0acb4/Untitled.png 392w" sizes="(max-width: 392px) 100vw, 392px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVQoz03O3U9ScRzH8fOXedPYWm2t1uZNzlaj+YTaajEc2sNSvKmpzYqlNltr5VNOsyjTHmyJmRaiYHBSkROIxFE4wJEDyLvjsQt/V9/fvt/Pax9B3k3yas6PklHRcjlSikJAFNmVZbbkFGuBFXxBkQ+vB5FDK4QiMTQ1g/e3xJNpD/sFDfdqmIlZLxEpjBBLqpjbnESnH3Lwcvkc0XiUkqYyE0zgsNcwMdhHs6Ucgm9J7hWhsMfQl2XKWl4YmY6JRaq7x6GUR0hkizS2dbL57LKxJBOnkAgZ4+dAnNu2KiZH+nDYzBCZp3Sw0INjbj+nHMP6p8AD1w9qnC59LiJE5Az1jntIA1bjWJwZYGfy7iH4K0ZrUzXvhvtovXYRJLceh301xdjCBqa6W2T7y+nWwfMNV8g+rUCIp/NY2rrYHrERVqGhqQnlY9chuHoEtOrgnzm9w0GRPcYXNzHVtJB2Hue+DlbW1ZPuPa2DikZdayfyqJ1IDmqtVopfewzw0+rWkYYX9Ib/wZKmgyFMtdfJPDppNKy0NJJ5fBZhW8lxtd3J6J0ynvu/Y7/hYKr/HDE1gVvc5abVzJvBHjqaLzHteslQTzskRcY8WxyrsqM4TxhgRa0FpfcMQr64T3A9jH95Cm9YRAyu4/W9R1Z3SKtFfMs/iUobLC3MsilJBLzzoCn8TWt8W/KRXl9gLRJn0eNBDXv4Bw9gDWA5F2sbAAAAAElFTkSuQmCC'); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="image" title="image" src="/static/05fde1b6d8247568aafaa766ea6a6519/c1b63/Untitled%201.png" srcset="/static/05fde1b6d8247568aafaa766ea6a6519/5a46d/Untitled%201.png 300w,
/static/05fde1b6d8247568aafaa766ea6a6519/0a47e/Untitled%201.png 600w,
/static/05fde1b6d8247568aafaa766ea6a6519/c1b63/Untitled%201.png 1200w,
/static/05fde1b6d8247568aafaa766ea6a6519/d61c2/Untitled%201.png 1800w,
/static/05fde1b6d8247568aafaa766ea6a6519/97a96/Untitled%201.png 2400w,
/static/05fde1b6d8247568aafaa766ea6a6519/3f99a/Untitled%201.png 2840w" sizes="(max-width: 1200px) 100vw, 1200px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/klEQVQozz2RS08TURSA+1Pc+GhY+UhcukbYUP8BJibamkBRN+ACBRdGV5ookSKgLUiJ0UB5lJIokGgINaltQEsJgjAwj5aCfc1MO593BspJ7l2ce+6X75zjwrLISBrJzX0UeQ9NlTEMwzkVXSf1R2Yxsc7G1g6H+Ty6yOuVMjtKjh8ZCVlVxR+VUqmELupdWCbtgSg3nkfQRu5wEOnGDtPQUbQszb3jNLS9ZXFt18nrhglVnf7ZOJfvD6MdlamHLeGCGm39UVqeTbL7ogn5/S3nsWoaaLkDrveEOe97w5fU9jGwJi4hYQMvdgwh5wtO3hKdOkDLrOAfmMMjgNIrD8qIzymolEuOYZMAutuHiS0sUQh7+fvuNrV/CoFYgkv3hlBOgLU60Nb3B+rAFgH0Yp0As7bh4zHc/iDR6BRK91nSXRew8pIA/hSGgyiHpdOWq2bVbtlygPYMpdce1NG7pwXZgzzNwrChI8hcbBbt6RU2eq9CUWFAGNozlHOHQk8sqmpQLBePgd6+aRqffEISM9wbaqVzroep1ASVosm1zmHO+AaZnomgPDrH7y43FBT6puO4H4RZ+/CQ3MtG/J87aA3dtIGwlNpkJr6OvDKJmpwnuDJKfCtu74uJ76uEviZZz6TJLY+hLn90tvxrW2H8WxopucD+Uoj51XkiiSn+A6/WFYndpvHBAAAAAElFTkSuQmCC'); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="image" title="image" src="/static/2adbbe301de0a9bce94e914b8f0ce46f/c1b63/Untitled%202.png" srcset="/static/2adbbe301de0a9bce94e914b8f0ce46f/5a46d/Untitled%202.png 300w,
/static/2adbbe301de0a9bce94e914b8f0ce46f/0a47e/Untitled%202.png 600w,
/static/2adbbe301de0a9bce94e914b8f0ce46f/c1b63/Untitled%202.png 1200w,
/static/2adbbe301de0a9bce94e914b8f0ce46f/d61c2/Untitled%202.png 1800w,
/static/2adbbe301de0a9bce94e914b8f0ce46f/97a96/Untitled%202.png 2400w,
/static/2adbbe301de0a9bce94e914b8f0ce46f/9f75f/Untitled%202.png 2858w" sizes="(max-width: 1200px) 100vw, 1200px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span>
<ul>
<li>Class of 60 and Above are consisted of only 17% of the total dataset.</li>
<li>Mask Class is distributed as Wear 7 : Incorrect 1 : Not Wear 1</li>
<li>RGB Mean was [0.56019358 0.52410121 0.501457]</li>
<li>RGB Standard Deviation was [0.23318603 0.24300033 0.24567522]</li>
<li>Out of 18 classes, there were two classes that consisted of only 0.44%(83 pics). There were also two classes that consisted of 20%(2000 pics).</li>
</ul>
<h3 id="choosing-loss-for-the-class-imbalance" style="position:relative;"><a href="#choosing-loss-for-the-class-imbalance" aria-label="choosing loss for the class imbalance permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choosing Loss for the Class Imbalance</h3>
<p>I decided to use FocalLoss in order to resolve such class imbalance. Compared to cross entropy loss, Focal Loss was purported to reduce the proportion of background on the training image which definitely outnumbered the size of the objects in the dataset. <strong>Focal Loss with gamma value of 5 outperformed Cross Entropy Loss.</strong></p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1052px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACAklEQVQoz42SaW/aQBCG8///TD+1VaR8akUDKVWJuCzA1xobG6/v9X28HS8tJEWqOmiNvTv7zPHOwzAAYeSj61uA3vu+x2jDePDGxu/buux15Fs2Lbquu957GB+ub6CsMlRVDcuywDlH09RI0xSmaSDLsjv4aFlewuIZoiiC53k3oMEUiDxG3/VQVRWO46AoS+nIeQDu+wiCAIyxd/A6i1Afl/J8vHMF+oEDpilyoygKVATrCN62rSylrmu5kiShzJsrMM8EuH2SwcIwvABHB+6f8WPyGf9rf0ou6wKhcKmSUAaTQMZMJHmO9fwJ28X8942eMhv+EuK2/hVIZpimgqA+Fk8fcNgpqN57oX8LxGUS4jiR7RnLFSK/AWVzqT8d/Xhogb18xX7xDcz1kNYD2vs80LUNlO0WL7MZnqdTRHF8PZXAnEpuaZ5EleAc2eCHHdzXZ2gE1ncbWAT3ohwF6eGnFbKypSQamaUgYeqqkv9jtRIohIBt26RUhLxMwIUHy9Fx3C/hrOfYTx6x/fIRCxJuOX3E5ucEyuYV5ukIRoIGaYSsyGgy2gvwfD7LIW5pI4lTOQI0NKiHCrqtUdYuBeJwjA201Xf4xxVObE5CfoK2n2Fn7WB4JooqvwDHJg9XDXr4NKjKVsF6tYZ6UMFMBkM3oZsW9qpOA27DOrok1r3KvwAqs5aYfjnZjAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="image" title="image" src="/static/da54f62f4cb8f20bc1d49f02fb19c55d/218a4/Untitled%204.png" srcset="/static/da54f62f4cb8f20bc1d49f02fb19c55d/5a46d/Untitled%204.png 300w,
/static/da54f62f4cb8f20bc1d49f02fb19c55d/0a47e/Untitled%204.png 600w,
/static/da54f62f4cb8f20bc1d49f02fb19c55d/218a4/Untitled%204.png 1052w" sizes="(max-width: 1052px) 100vw, 1052px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">class</span><span class="mtk1"> </span><span class="mtk11">FocalLoss</span><span class="mtk1">(</span><span class="mtk11">nn</span><span class="mtk1">.</span><span class="mtk11">Module</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk8">__init__</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">, </span><span class="mtk7 mtki">weight</span><span class="mtk1">=</span><span class="mtk7">None</span><span class="mtk1">, </span><span class="mtk7 mtki">gamma</span><span class="mtk1">=</span><span class="mtk7">2</span><span class="mtk1">., </span><span class="mtk7 mtki">reduction</span><span class="mtk1">=</span><span class="mtk6">&#39;mean&#39;</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        nn.Module.</span><span class="mtk8">__init__</span><span class="mtk1">(</span><span class="mtk11">self</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.weight </span><span class="mtk8">=</span><span class="mtk1"> weight</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.gamma </span><span class="mtk8">=</span><span class="mtk1"> gamma</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.reduction </span><span class="mtk8">=</span><span class="mtk1"> reduction</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk3">forward</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">, </span><span class="mtk7 mtki">input_tensor</span><span class="mtk1">, </span><span class="mtk7 mtki">target_tensor</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        log_prob </span><span class="mtk8">=</span><span class="mtk1"> F.</span><span class="mtk3">log_softmax</span><span class="mtk1">(input_tensor, </span><span class="mtk4 mtki">dim</span><span class="mtk8">=-</span><span class="mtk7">1</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        prob </span><span class="mtk8">=</span><span class="mtk1"> torch.</span><span class="mtk3">exp</span><span class="mtk1">(log_prob)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">return</span><span class="mtk1"> F.</span><span class="mtk3">nll_loss</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            ((</span><span class="mtk7">1</span><span class="mtk1"> </span><span class="mtk8">-</span><span class="mtk1"> prob) </span><span class="mtk8">**</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.gamma) </span><span class="mtk8">*</span><span class="mtk1"> log_prob,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            target_tensor,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4 mtki">weight</span><span class="mtk8">=</span><span class="mtk11">self</span><span class="mtk1">.weight,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4 mtki">reduction</span><span class="mtk8">=</span><span class="mtk11">self</span><span class="mtk1">.reduction</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        )</span></span></span></code></pre>
<h3 id="adding-dataset-to-resolve-class-imbalance" style="position:relative;"><a href="#adding-dataset-to-resolve-class-imbalance" aria-label="adding dataset to resolve class imbalance permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding Dataset to resolve class imbalance</h3>
<ul>
<li>Also, in order to resolve the class imbalance I decided to add external dataset for the Age of 60 from <a href="https://github.com/JingchunCheng/All-Age-Faces-Dataset">All-Age-Faces-Dataset</a>.</li>
<li><a href="https://github.com/aqeelanwar/MaskTheFace">Using the MaskTheFace opensource project</a>, User can arbitrarily choose the color, color weight, patterns and the types of mask.</li>
<li><strong>From two open-source projects, I constructed external dataset like the following:</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="center">normal</th>
<th align="center">mask1</th>
<th align="center">mask2</th>
<th align="center">mask3</th>
<th align="center">mask4</th>
<th align="center">mask5</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 128.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAAFA//EABcBAAMBAAAAAAAAAAAAAAAAAAACAwH/2gAMAwEAAhADEAAAAQoFoStykWOBuCp4711g/8QAHRAAAgEEAwAAAAAAAAAAAAAAAQIAAxITIRARIv/aAAgBAQABBQKiQtPy0xJFBuO0l+0PS2DigxyT/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAESETH/2gAIAQMBAT8BXDEUUz//xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQIBAT8B1UR//8QAHRAAAQMFAQAAAAAAAAAAAAAAAQAQIREgMkFhkf/aAAgBAQAGPwKdqR6sUBx62CS3/8QAHBABAAEFAQEAAAAAAAAAAAAAAQAQESExQZFx/9oACAEBAAE/Ibz2WCcfFF3SGsL4TkOboBJcmIA3cdtPpQoHtNhP/9oADAMBAAIAAwAAABBvIML/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFh/9oACAEDAQE/EHkGQnND/8QAGBEBAQADAAAAAAAAAAAAAAAAABEBMVH/2gAIAQIBAT8Q2V1ll//EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQWEQcf/aAAgBAQABPxAu2tAtayDwNeA9loo/FJYwhQDpLhXFotTpGJsInQWHqU1K4BngPF+BYA2AoNh1TVn/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="12792A62"
        title="12792A62"
        src="/static/d9bc0472958ae9c115b6659eb3e9ed39/6d442/12792A62.jpg"
        srcset="/static/d9bc0472958ae9c115b6659eb3e9ed39/f93b5/12792A62.jpg 300w,
/static/d9bc0472958ae9c115b6659eb3e9ed39/6d442/12792A62.jpg 309w"
        sizes="(max-width: 309px) 100vw, 309px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></td>
<td align="center"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 128.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAABAADBQb/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAQoF0CbKRTZmecUwd61sX//EAB0QAAICAgMBAAAAAAAAAAAAAAECAAMSExARISL/2gAIAQEAAQUCpIWv5aakig5N6krsE7AmA4oY7J//xAAYEQADAQEAAAAAAAAAAAAAAAAAARESMf/aAAgBAwEBPwFcIimmf//EABYRAQEBAAAAAAAAAAAAAAAAABEAAf/aAAgBAgEBPwHZkwi//8QAHhAAAQMEAwAAAAAAAAAAAAAAAAEQIREyQVFhkcH/2gAIAQEABj8CnJKdlpTh/TbpKt//xAAeEAABBAIDAQAAAAAAAAAAAAABABEhMRBBUWGRcf/aAAgBAQABPyF52KAtPiROaIYGPBcDV4dkQHjombvKyNr6YFAPZWAv/9oADAMBAAIAAwAAABBvIEL/xAAYEQADAQEAAAAAAAAAAAAAAAAAARFhIf/aAAgBAwEBPxB5BkKus0P/xAAXEQEBAQEAAAAAAAAAAAAAAAAAETFR/9oACAECAQE/ENK6qBL/xAAcEAEAAwADAQEAAAAAAAAAAAABABEhMUFhcRD/2gAIAQEAAT8QLtrQLWsg8DXgPZaKvikscQoB0lwLg6LU6RibLYWrTqOoWsIYrp8ngPF/AMAbAXMNDqmrP//Z'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="12792A62_KN95_5"
        title="12792A62_KN95_5"
        src="/static/d8fef3e0ae037a137666a00b62269ed8/6d442/12792A62_KN95_5.jpg"
        srcset="/static/d8fef3e0ae037a137666a00b62269ed8/f93b5/12792A62_KN95_5.jpg 300w,
/static/d8fef3e0ae037a137666a00b62269ed8/6d442/12792A62_KN95_5.jpg 309w"
        sizes="(max-width: 309px) 100vw, 309px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></td>
<td align="center"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 128.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAXAQADAQAAAAAAAAAAAAAAAAABAgMA/9oADAMBAAIQAxAAAAFFhKjK2IwB1anKtNG8ah3/xAAbEAACAwEBAQAAAAAAAAAAAAABAgADEhMQIv/aAAgBAQABBQKkha/lpySKDpgcSp16NYuMDyhj0n//xAAYEQADAQEAAAAAAAAAAAAAAAAAARIRMf/aAAgBAwEBPwFcMRRTP//EABcRAQEBAQAAAAAAAAAAAAAAAAABEQL/2gAIAQIBAT8BrV5Y/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAEQISAxMkFhkf/aAAgBAQAGPwK+S16bRLo0hN4K3H//xAAcEAACAwADAQAAAAAAAAAAAAABEQAhMRBxkUH/2gAIAQEAAT8hc9FQnx8UJziDIOkMRhTfDVhY4atHq52cCgHtNAn/2gAMAwEAAgADAAAAEG8ggv/EABcRAAMBAAAAAAAAAAAAAAAAAAABEWH/2gAIAQMBAT8QeQZCo0P/xAAYEQADAQEAAAAAAAAAAAAAAAAAARExUf/aAAgBAgEBPxDRXRLdJP/EAB0QAQADAQACAwAAAAAAAAAAAAEAESExQWEQUXH/2gAIAQEAAT8QLtrQLWsg8GvA9loq/FJYwhQDwlxCuQpxGJsw8DDx9TfRU3kT0D0vwFgDYChodU1Z/9k='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="12792A62_N95_64"
        title="12792A62_N95_64"
        src="/static/833ffca9a95f7c4e93df1c7e2d952b07/6d442/12792A62_N95_64.jpg"
        srcset="/static/833ffca9a95f7c4e93df1c7e2d952b07/f93b5/12792A62_N95_64.jpg 300w,
/static/833ffca9a95f7c4e93df1c7e2d952b07/6d442/12792A62_N95_64.jpg 309w"
        sizes="(max-width: 309px) 100vw, 309px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></td>
<td align="center"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 128.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMBAv/aAAwDAQACEAMQAAABhoi0CZRQTcT8WpA3hpL/AP/EABwQAAICAgMAAAAAAAAAAAAAAAECAAMSExAhIv/aAAgBAQABBQKkha/LTUkUHI9pA4MSYjihjsn/xAAYEQADAQEAAAAAAAAAAAAAAAAAARESMf/aAAgBAwEBPwFcIimmf//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwHVRH//xAAcEAABBAMBAAAAAAAAAAAAAAABABAhYSAyQZH/2gAIAQEABj8CnqkerVAVhTiS3//EAB0QAAICAgMBAAAAAAAAAAAAAAABMUERIRBRkXH/2gAIAQEAAT8hzOTaRT4hvcBbAzoRkqnriwQ1vQ+3CqF7EpH/2gAMAwEAAgADAAAAEG8gQv/EABgRAAMBAQAAAAAAAAAAAAAAAAABEWEh/9oACAEDAQE/EHkGQq6aH//EABkRAAIDAQAAAAAAAAAAAAAAAAARASExUf/aAAgBAgEBPxDQ3SUoU//EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQWEQcf/aAAgBAQABPxAu2tAtayDwNeA9loq/FJYwhQDpLhVTlqdhibG10oBJSgoOp3PIeL8AwBsBQ0Oqas//2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="12792A62_cloth_16"
        title="12792A62_cloth_16"
        src="/static/af4d741da611fe414468cc67041c2cb4/6d442/12792A62_cloth_16.jpg"
        srcset="/static/af4d741da611fe414468cc67041c2cb4/f93b5/12792A62_cloth_16.jpg 300w,
/static/af4d741da611fe414468cc67041c2cb4/6d442/12792A62_cloth_16.jpg 309w"
        sizes="(max-width: 309px) 100vw, 309px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></td>
<td align="center"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 128.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEBQb/xAAXAQADAQAAAAAAAAAAAAAAAAABAgME/9oADAMBAAIQAxAAAAGGiPQlZJQB028xVTPvDQN//8QAHBAAAgICAwAAAAAAAAAAAAAAAQIAAxITEBEi/9oACAEBAAEFAqSFr8tNSRVOTA4Sm5QxsHWI4oY7J//EABkRAQACAwAAAAAAAAAAAAAAAAEAEBESIf/aAAgBAwEBPwEeTBWzP//EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8BZch//8QAHhAAAgEDBQAAAAAAAAAAAAAAAAEhEBFBIDEyYZH/2gAIAQEABj8CnJK9OIl0bUd86FLp/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITEQQZFx/9oACAEBAAE/IbnssE6fFF3SEqLhiYhZi74ZFoFke82M+3BQPabCf//aAAwDAQACAAMAAAAQWyTC/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERYf/aAAgBAwEBPxCUGRU3WaH/xAAYEQADAQEAAAAAAAAAAAAAAAAAARExUf/aAAgBAgEBPxDRXRppQk//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhMWEQcf/aAAgBAQABPxAu2tAtayDwa8D2Wir8UhQaKAvEuOVC0HEYmwmFWNyuXB62ZrcnkPF+BYA2AoaHVNWf/9k='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="12792A62_surgical_63"
        title="12792A62_surgical_63"
        src="/static/217fcd31e5d13e5e1a29a9ee2438e044/6d442/12792A62_surgical_63.jpg"
        srcset="/static/217fcd31e5d13e5e1a29a9ee2438e044/f93b5/12792A62_surgical_63.jpg 300w,
/static/217fcd31e5d13e5e1a29a9ee2438e044/6d442/12792A62_surgical_63.jpg 309w"
        sizes="(max-width: 309px) 100vw, 309px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></td>
<td align="center"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 128.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAAFA//EABcBAAMBAAAAAAAAAAAAAAAAAAECAwD/2gAMAwEAAhADEAAAAQoFoStykQcisBTy3rrYf//EAB0QAAICAgMBAAAAAAAAAAAAAAECAAMSExARISL/2gAIAQEAAQUCpIWv5aakig5N6kSwdhhMRxQx2T//xAAaEQACAgMAAAAAAAAAAAAAAAAAAQIREiEx/9oACAEDAQE/AVwpCnoyZ//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwHVRH//xAAdEAABAwUBAAAAAAAAAAAAAAAAARAhETEyQWGR/9oACAEBAAY/Ap2SnpiU4WfjpKt//8QAHRABAAICAgMAAAAAAAAAAAAAAQAREDEhkUFRcf/aAAgBAQABPyG57Lgnh6UXdIYUvhA0em8Wauyrmwx9sFA7psJ//9oADAMBAAIAAwAAABB/LML/xAAYEQADAQEAAAAAAAAAAAAAAAAAAWERIf/aAAgBAwEBPxB2sEhvBQ//xAAYEQEBAAMAAAAAAAAAAAAAAAAAEQExUf/aAAgBAgEBPxDZXWWX/8QAHBABAAMBAQADAAAAAAAAAAAAAQARITFhEEFx/9oACAEBAAE/EC7a0C1rIPBrwPZaKvxSW+IUA+kuMbCreEYmwwDCh5XIgsXhrbnkPF+AsAbAUNDqmrP/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="12792A62_surgical_31"
        title="12792A62_surgical_31"
        src="/static/87d4018541ffd5cc69056ea9dac7bd04/6d442/12792A62_surgical_31.jpg"
        srcset="/static/87d4018541ffd5cc69056ea9dac7bd04/f93b5/12792A62_surgical_31.jpg 300w,
/static/87d4018541ffd5cc69056ea9dac7bd04/6d442/12792A62_surgical_31.jpg 309w"
        sizes="(max-width: 309px) 100vw, 309px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></td>
</tr>
</tbody>
</table>
<ul>
<li>By adding 646 males and 620 females who were age 60 and above, I thought this would have helped the model's performance on age classification.</li>
<li>The format of the added image folder, the format of the added image information on <code>train.csv</code> adhered to according to the competition's provided format.</li>
<li>For example, previous train dataset started with id number of <code>0xxxxx</code> Individual ids. Additional external train dataset were concat where male id starts with <code>1xxxxx</code> and female ids starts with <code>2xxxxx</code> , in order to separate itself from the original dataset.</li>
<li>The following is the code for randomizing mask pattern and color weight for individuals. The project did provide batch processing, but it did not provide function for randomizing both pattern and color.</li>
<li>Unfortunately the following code didn't help the model performance to improve. It was both experimented by me and my teammates, but the f1_score oscilated in between the significance probability level 0.05.</li>
</ul>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> os</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> random</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> glob</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> itertools</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> IPython.display </span><span class="mtk10 mtki">import</span><span class="mtk1"> clear_output</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">BASE_COMMAND</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;python mask_the_face.py&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">PATTERN_PATH</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/Users/noopy/Documents/dataset-kitchen/_clones/MaskTheFace/masks/textures&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">OLD_MALE_PATH</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/Users/noopy/Documents/dataset-kitchen/_clones/_DATASET/Old-Male/AGEFACE&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">OLD_FEMALE_PATH</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/Users/noopy/Documents/dataset-kitchen/_clones/_DATASET/Old-Female/AGEFACE&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">mask_types </span><span class="mtk8">=</span><span class="mtk1"> [</span><span class="mtk6">&quot;surgical_green&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;surgical_blue&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;N95&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;KN95&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;cloth&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># find all items in the folder</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">images_paths </span><span class="mtk8">=</span><span class="mtk1"> glob.</span><span class="mtk3">glob</span><span class="mtk1">(os.path.</span><span class="mtk3">join</span><span class="mtk1">(</span><span class="mtk7">OLD_MALE_PATH</span><span class="mtk1">, </span><span class="mtk6">&quot;*&quot;</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(images_paths))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># repeat the list images_path by 5 times</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">images_paths </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">list</span><span class="mtk1">(itertools.chain.</span><span class="mtk3">from_iterable</span><span class="mtk1">(itertools.</span><span class="mtk3">repeat</span><span class="mtk1">(x, </span><span class="mtk7">5</span><span class="mtk1">) </span><span class="mtk10 mtki">for</span><span class="mtk1"> x </span><span class="mtk10 mtki">in</span><span class="mtk1"> images_paths))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(images_paths))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># get random hex values color</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk3">get_random_color</span><span class="mtk1">():</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk10 mtki">return</span><span class="mtk1"> </span><span class="mtk6">&#39;#</span><span class="mtk7">%02x%02x%02x</span><span class="mtk6">&#39;</span><span class="mtk1"> </span><span class="mtk8">%</span><span class="mtk1"> (random.</span><span class="mtk3">randint</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">255</span><span class="mtk1">), random.</span><span class="mtk3">randint</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">255</span><span class="mtk1">), random.</span><span class="mtk3">randint</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">255</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">mask_types </span><span class="mtk8">=</span><span class="mtk1"> [</span><span class="mtk6">&quot;surgical_green&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;surgical_blue&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;N95&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;KN95&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;cloth&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># get folders in side of pattern_path</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">folders </span><span class="mtk8">=</span><span class="mtk1"> [os.path.</span><span class="mtk3">join</span><span class="mtk1">(</span><span class="mtk7">PATTERN_PATH</span><span class="mtk1">, folder) </span><span class="mtk10 mtki">for</span><span class="mtk1"> folder </span><span class="mtk10">in</span><span class="mtk1"> os.</span><span class="mtk3">listdir</span><span class="mtk1">(</span><span class="mtk7">PATTERN_PATH</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">patterns </span><span class="mtk8">=</span><span class="mtk1"> []</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">for</span><span class="mtk1"> folder </span><span class="mtk10">in</span><span class="mtk1"> folders:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki"># collect all jpg and png items inside of the folder</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  patterns </span><span class="mtk8">+=</span><span class="mtk1"> glob.</span><span class="mtk3">glob</span><span class="mtk1">(os.path.</span><span class="mtk3">join</span><span class="mtk1">(folder, </span><span class="mtk6">&quot;*.jpg&quot;</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  patterns </span><span class="mtk8">+=</span><span class="mtk1"> glob.</span><span class="mtk3">glob</span><span class="mtk1">(os.path.</span><span class="mtk3">join</span><span class="mtk1">(folder, </span><span class="mtk6">&quot;*.png&quot;</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">for</span><span class="mtk1"> path </span><span class="mtk10">in</span><span class="mtk1"> images_paths:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># chose random item from the list</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    mask_type </span><span class="mtk8">=</span><span class="mtk1"> mask_types[random.</span><span class="mtk3">randint</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk8">len</span><span class="mtk1">(mask_types) </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">1</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># range color weight between 0.2 to 0.7</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    color_weight </span><span class="mtk8">=</span><span class="mtk1"> random.</span><span class="mtk3">uniform</span><span class="mtk1">(</span><span class="mtk7">0.2</span><span class="mtk1">, </span><span class="mtk7">0.7</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># define random hex color</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    color_hex </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">get_random_color</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># get random path out of patterns</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    patterns_path </span><span class="mtk8">=</span><span class="mtk1"> random.</span><span class="mtk3">choice</span><span class="mtk1">(patterns)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># get random pattern weight out of [0, 0.5, 1], choose more weight on 0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    pattern_weight </span><span class="mtk8">=</span><span class="mtk1"> random.</span><span class="mtk3">choice</span><span class="mtk1">([</span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.0</span><span class="mtk1">, </span><span class="mtk7">0.5</span><span class="mtk1">, </span><span class="mtk7">1.0</span><span class="mtk1">])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># generate the command</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    command </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">f</span><span class="mtk6">&quot;</span><span class="mtk7">{BASE_COMMAND}</span><span class="mtk6"> </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --path &#39;</span><span class="mtk7">{</span><span class="mtk1">path</span><span class="mtk7">}</span><span class="mtk6">&#39; </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --mask_type random </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --pattern &#39;</span><span class="mtk7">{</span><span class="mtk1">patterns_path</span><span class="mtk7">}</span><span class="mtk6">&#39; </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --pattern_weight </span><span class="mtk7">{</span><span class="mtk1">pattern_weight</span><span class="mtk7">}</span><span class="mtk6"> </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --color &#39;</span><span class="mtk7">{</span><span class="mtk1">color_hex</span><span class="mtk7">}</span><span class="mtk6">&#39; </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --color_weight </span><span class="mtk7">{</span><span class="mtk1">color_weight</span><span class="mtk7">}</span><span class="mtk6"> </span><span class="mtk7">\</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">        --verbose&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># execute the command</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    os.</span><span class="mtk3">system</span><span class="mtk1">(command)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># clear the output</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">clear_output</span><span class="mtk1">()</span></span></span></code></pre>
<h3 id="oversampling-to-alleviate-class-imbalance" style="position:relative;"><a href="#oversampling-to-alleviate-class-imbalance" aria-label="oversampling to alleviate class imbalance permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Oversampling to Alleviate Class Imbalance.</h3>
<ul>
<li>Since the class age 60 and above only included the age of 60, my teammates suggested to use age 58 &#x26; age 59 to relabeled as the class of age 60 and above.</li>
<li><strong>This oversampling attempt significantly improved the validation f1 score from 0.75 to 0.76.</strong></li>
</ul>
<h2 id="cropping-face-to-reduce-noise" style="position:relative;"><a href="#cropping-face-to-reduce-noise" aria-label="cropping face to reduce noise permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cropping face to reduce noise</h2>
<p><a href="https://github.com/snoop2head/debugging-practice/blob/main/5_Locate_face_bounding_box_facenet_pytorch.ipynb">ðŸ”— Locate<em>face</em>bounding<em>box</em>MTCNN_Retinaface.ipynb</a></p>
<ul>
<li>I thought it was important to reduce the background noise intervention for the train dataset. Therefore, it was essential to either Centercrop or extract the face data only from the image.</li>
<li><strong>I combined MTCNN that utilized GPU but with lower accuracy, Retinace that utilized CPU only but with higher accuracy.</strong></li>
<li>I shared the code with other Naver BoostCamp participants and it seems like many groups have implemented it.</li>
</ul>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> torch</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> torch.nn </span><span class="mtk10 mtki">as</span><span class="mtk1"> nn</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> pandas </span><span class="mtk10 mtki">as</span><span class="mtk1"> pd</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> numpy </span><span class="mtk10 mtki">as</span><span class="mtk1"> np</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> os</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> cv2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> facenet_pytorch </span><span class="mtk10 mtki">import</span><span class="mtk1"> </span><span class="mtk7">MTCNN</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> tqdm.notebook </span><span class="mtk10 mtki">import</span><span class="mtk1"> tqdm</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> retinaface </span><span class="mtk10 mtki">import</span><span class="mtk1"> RetinaFace</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> glob</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># make empty dataframe</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_image </span><span class="mtk8">=</span><span class="mtk1"> pd.</span><span class="mtk3">DataFrame</span><span class="mtk1">({})</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">cnt </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1"> </span><span class="mtk5 mtki"># intialize iteration count</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># padding value before cropping</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">X_PADDING</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">20</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">Y_PADDING</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">30</span><span class="mtk1"> </span><span class="mtk5 mtki"># gave more padding in order to include mask on the chin &amp; hair style</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># iterrate rows for the given training dataset</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">for</span><span class="mtk1"> index, row </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk3">tqdm</span><span class="mtk1">(df_label.</span><span class="mtk3">iterrows</span><span class="mtk1">()):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki"># get default values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  train_image_paths </span><span class="mtk8">=</span><span class="mtk1"> []</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">id</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> row[</span><span class="mtk6">&quot;id&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  gender </span><span class="mtk8">=</span><span class="mtk1"> row[</span><span class="mtk6">&quot;gender&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  race </span><span class="mtk8">=</span><span class="mtk1"> row[</span><span class="mtk6">&quot;race&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  age </span><span class="mtk8">=</span><span class="mtk1"> row[</span><span class="mtk6">&quot;age&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  profile </span><span class="mtk8">=</span><span class="mtk1"> row[</span><span class="mtk6">&quot;path&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  profile_path </span><span class="mtk8">=</span><span class="mtk1"> os.path.</span><span class="mtk3">join</span><span class="mtk1">(</span><span class="mtk7">TRAIN_IMGS_DATASET_PATH</span><span class="mtk1">, profile)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki"># print(profile_path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki"># get list of images from the given profile path</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  jpg_file_list </span><span class="mtk8">=</span><span class="mtk1"> glob.</span><span class="mtk3">glob</span><span class="mtk1">(</span><span class="mtk10">f</span><span class="mtk6">&quot;</span><span class="mtk7">{</span><span class="mtk1">profile_path</span><span class="mtk7">}</span><span class="mtk6">/*.jpg&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  jpeg_file_list </span><span class="mtk8">=</span><span class="mtk1"> glob.</span><span class="mtk3">glob</span><span class="mtk1">(</span><span class="mtk10">f</span><span class="mtk6">&quot;</span><span class="mtk7">{</span><span class="mtk1">profile_path</span><span class="mtk7">}</span><span class="mtk6">/*.jpeg&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  png_file_list </span><span class="mtk8">=</span><span class="mtk1"> glob.</span><span class="mtk3">glob</span><span class="mtk1">(</span><span class="mtk10">f</span><span class="mtk6">&quot;</span><span class="mtk7">{</span><span class="mtk1">profile_path</span><span class="mtk7">}</span><span class="mtk6">/*.png&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  list_images </span><span class="mtk8">=</span><span class="mtk1"> jpg_file_list </span><span class="mtk8">+</span><span class="mtk1"> jpeg_file_list </span><span class="mtk8">+</span><span class="mtk1"> png_file_list</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki"># print(list_images)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk10 mtki">for</span><span class="mtk1"> image_file_path </span><span class="mtk10">in</span><span class="mtk1"> list_images:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    cnt </span><span class="mtk8">+=</span><span class="mtk1"> </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># read image and extract information using mtcnn</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    img </span><span class="mtk8">=</span><span class="mtk1"> cv2.</span><span class="mtk3">imread</span><span class="mtk1">(image_file_path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    img </span><span class="mtk8">=</span><span class="mtk1"> cv2.</span><span class="mtk3">cvtColor</span><span class="mtk1">(img, cv2.</span><span class="mtk7">COLOR_BGR2RGB</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    boxes, probs, landmarks </span><span class="mtk8">=</span><span class="mtk1"> mtcnn.</span><span class="mtk3">detect</span><span class="mtk1">(img, </span><span class="mtk4 mtki">landmarks</span><span class="mtk8">=</span><span class="mtk7">True</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># default detection with mtcnn</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10 mtki">if</span><span class="mtk1"> probs[</span><span class="mtk7">0</span><span class="mtk1">]:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki"># print(&quot;solved with mtcnn&quot;)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki"># save face bounding box information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      xmin </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(boxes[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">]) </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">X_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      ymin </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(boxes[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">]) </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">Y_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      xmax </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(boxes[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">2</span><span class="mtk1">]) </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">X_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      ymax </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(boxes[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">3</span><span class="mtk1">]) </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">Y_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki"># save landmark information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      left_eye </span><span class="mtk8">=</span><span class="mtk1"> landmarks[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      right_eye </span><span class="mtk8">=</span><span class="mtk1"> landmarks[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      mouth_left </span><span class="mtk8">=</span><span class="mtk1"> landmarks[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">2</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      mouth_right </span><span class="mtk8">=</span><span class="mtk1"> landmarks[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">3</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      nose </span><span class="mtk8">=</span><span class="mtk1"> landmarks[</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk7">4</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># if mtcnn fails, use retinaface</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10 mtki">else</span><span class="mtk1">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      result_detected </span><span class="mtk8">=</span><span class="mtk1"> RetinaFace.</span><span class="mtk3">detect_faces</span><span class="mtk1">(image_file_path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki"># print(result_detected)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki"># try retinaface to resolve,:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk10 mtki">if</span><span class="mtk1"> </span><span class="mtk8">type</span><span class="mtk1">(result_detected) </span><span class="mtk8">==</span><span class="mtk1"> </span><span class="mtk8">dict</span><span class="mtk1">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk6">&quot;resolving with retinaface: &quot;</span><span class="mtk1">, image_file_path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># save face bounding box information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        xmin </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(result_detected[</span><span class="mtk6">&quot;face_1&quot;</span><span class="mtk1">][</span><span class="mtk6">&quot;facial_area&quot;</span><span class="mtk1">][</span><span class="mtk7">0</span><span class="mtk1">]) </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">X_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ymin </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(result_detected[</span><span class="mtk6">&quot;face_1&quot;</span><span class="mtk1">][</span><span class="mtk6">&quot;facial_area&quot;</span><span class="mtk1">][</span><span class="mtk7">1</span><span class="mtk1">]) </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">Y_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        xmax </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(result_detected[</span><span class="mtk6">&quot;face_1&quot;</span><span class="mtk1">][</span><span class="mtk6">&quot;facial_area&quot;</span><span class="mtk1">][</span><span class="mtk7">2</span><span class="mtk1">]) </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">X_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ymax </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(result_detected[</span><span class="mtk6">&quot;face_1&quot;</span><span class="mtk1">][</span><span class="mtk6">&quot;facial_area&quot;</span><span class="mtk1">][</span><span class="mtk7">3</span><span class="mtk1">]) </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">Y_PADDING</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># save landmark information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        face_landmarks </span><span class="mtk8">=</span><span class="mtk1"> result_detected[</span><span class="mtk6">&quot;face_1&quot;</span><span class="mtk1">][</span><span class="mtk6">&quot;landmarks&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        left_eye </span><span class="mtk8">=</span><span class="mtk1"> face_landmarks[</span><span class="mtk6">&quot;left_eye&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        right_eye </span><span class="mtk8">=</span><span class="mtk1"> face_landmarks[</span><span class="mtk6">&quot;right_eye&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        mouth_left </span><span class="mtk8">=</span><span class="mtk1"> face_landmarks[</span><span class="mtk6">&quot;mouth_left&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        mouth_right </span><span class="mtk8">=</span><span class="mtk1"> face_landmarks[</span><span class="mtk6">&quot;mouth_right&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        nose </span><span class="mtk8">=</span><span class="mtk1"> face_landmarks[</span><span class="mtk6">&quot;nose&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki"># if both of the detection fails, center crop</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk10 mtki">elif</span><span class="mtk1"> </span><span class="mtk8">type</span><span class="mtk1">(result_detected) </span><span class="mtk8">==</span><span class="mtk1"> </span><span class="mtk8">tuple</span><span class="mtk1">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk6">&quot;this one is causing trouble: &quot;</span><span class="mtk1">, image_file_path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># manually set coordinates</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># xmin = 50</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># ymin = 100</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># xmax = 350</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># ymax = 400</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        xmin </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">80</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ymin </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">50</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        xmax </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">80</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">220</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ymax </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">50</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">320</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki"># leave landmark information empty</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        face_landmarks </span><span class="mtk8">=</span><span class="mtk1"> left_eye </span><span class="mtk8">=</span><span class="mtk1"> right_eye </span><span class="mtk8">=</span><span class="mtk1"> np.nan</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        mouth_left </span><span class="mtk8">=</span><span class="mtk1"> mouth_right </span><span class="mtk8">=</span><span class="mtk1"> nose </span><span class="mtk8">=</span><span class="mtk1"> np.nan</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># add row to the df_images with the extracted information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    df_image </span><span class="mtk8">=</span><span class="mtk1"> df_image.</span><span class="mtk3">append</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;id&quot;</span><span class="mtk1">:</span><span class="mtk8">id</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;gender&quot;</span><span class="mtk1">:gender,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;race&quot;</span><span class="mtk1">:race,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;age&quot;</span><span class="mtk1">:age,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;path&quot;</span><span class="mtk1">: profile,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">: image_file_path,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;xmin&quot;</span><span class="mtk1">: xmin,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;ymin&quot;</span><span class="mtk1">: ymin,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;xmax&quot;</span><span class="mtk1">: xmax,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;ymax&quot;</span><span class="mtk1">: ymax,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;left_eye&quot;</span><span class="mtk1">: left_eye,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;right_eye&quot;</span><span class="mtk1">: right_eye,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;mouth_left&quot;</span><span class="mtk1">: mouth_left,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;mouth_right&quot;</span><span class="mtk1">: mouth_right,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&quot;nose&quot;</span><span class="mtk1">: nose</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }, </span><span class="mtk4 mtki">ignore_index</span><span class="mtk8">=</span><span class="mtk7">True</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki"># print data information every 100 iterations</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10 mtki">if</span><span class="mtk1"> cnt </span><span class="mtk8">%</span><span class="mtk1"> </span><span class="mtk7">100</span><span class="mtk1"> </span><span class="mtk8">==</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk8">print</span><span class="mtk1">(df_image.shape)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk8">print</span><span class="mtk1">(df_image.</span><span class="mtk3">info</span><span class="mtk1">())</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk8">print</span><span class="mtk1">(df_image.</span><span class="mtk3">tail</span><span class="mtk1">())</span></span></span></code></pre>
<ul>
<li>Landmark information and face coordinates were integrated with <code>train.csv</code> file for later image cropping: it purported to be processed in cv2 or PIL.</li>
<li>It did improve ViT models' performance. <strong>However, it turned out that extracting facial characteristics didn't improve the Efficientnet model's performance.</strong> Result turned out that center cropping (horizontal = 400, width = 200) pixel were more effective for efficientnet models. Center cropping with longer height included essential characteristics to include neck wrinkles &#x26; facial wrinkles to discern age class.</li>
<li>
<p>Pictures were often exceptionally cropped in small size. This was because MTCNN of Pytorch FaceNet often detected patterns of the mask or patterns of the clothes as eyes/nose/lips. These anomalies were later filtered by cropped pictures' width and height.</p>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> pandas </span><span class="mtk10 mtki">as</span><span class="mtk1"> pd</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> numpy </span><span class="mtk10 mtki">as</span><span class="mtk1"> np</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">import</span><span class="mtk1"> matplotlib.pyplot </span><span class="mtk10 mtki">as</span><span class="mtk1"> plt</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># read train_images.csv which contains predefined facial coordinate information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train </span><span class="mtk8">=</span><span class="mtk1"> pd.</span><span class="mtk3">read_csv</span><span class="mtk1">(</span><span class="mtk6">&#39;./train_images.csv&#39;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train.</span><span class="mtk3">head</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">x_range </span><span class="mtk8">=</span><span class="mtk1"> df_train_new[</span><span class="mtk6">&quot;xmax&quot;</span><span class="mtk1">] </span><span class="mtk8">-</span><span class="mtk1"> df_train_new[</span><span class="mtk6">&quot;xmin&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">y_range </span><span class="mtk8">=</span><span class="mtk1"> df_train_new[</span><span class="mtk6">&quot;ymax&quot;</span><span class="mtk1">] </span><span class="mtk8">-</span><span class="mtk1"> df_train_new[</span><span class="mtk6">&quot;ymin&quot;</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># plot distribution of x_range</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">plt.</span><span class="mtk3">hist</span><span class="mtk1">(x_range, </span><span class="mtk4 mtki">bins</span><span class="mtk8">=</span><span class="mtk7">100</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># check distribution statistics of x_range</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">x_range.</span><span class="mtk3">describe</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># set minimum for the width by mean - 1.96 sigma (approximately bottom 3%)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">x_restriction </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(x_range.</span><span class="mtk3">mean</span><span class="mtk1">() </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">1.96</span><span class="mtk1"> </span><span class="mtk8">*</span><span class="mtk1"> x_range.</span><span class="mtk3">std</span><span class="mtk1">()) </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># plot distribution of y_range</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">plt.</span><span class="mtk3">hist</span><span class="mtk1">(y_range, </span><span class="mtk4 mtki">bins</span><span class="mtk8">=</span><span class="mtk7">100</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># set minimum for the height by mean - 1.96 sigma (approximately bottom 3%)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">y_restriction </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">int</span><span class="mtk1">(y_range.</span><span class="mtk3">mean</span><span class="mtk1">() </span><span class="mtk8">-</span><span class="mtk1"> </span><span class="mtk7">1.96</span><span class="mtk1"> </span><span class="mtk8">*</span><span class="mtk1"> y_range.</span><span class="mtk3">std</span><span class="mtk1">()) </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># get undersized cropped images that are under miniumum width and minum height</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_too_small </span><span class="mtk8">=</span><span class="mtk1"> df_train_new[(df_train_new[</span><span class="mtk6">&quot;xmax&quot;</span><span class="mtk1">] </span><span class="mtk8">-</span><span class="mtk1"> df_train_new[</span><span class="mtk6">&quot;xmin&quot;</span><span class="mtk1">] </span><span class="mtk8">&lt;</span><span class="mtk1"> x_border) </span><span class="mtk8">&amp;</span><span class="mtk1"> (df_train_new[</span><span class="mtk6">&quot;ymax&quot;</span><span class="mtk1">] </span><span class="mtk8">-</span><span class="mtk1"> df_train_new[</span><span class="mtk6">&quot;ymin&quot;</span><span class="mtk1">] </span><span class="mtk8">&lt;</span><span class="mtk1"> y_border)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_too_small.</span><span class="mtk3">info</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># set xmin = 80, ymin = 50, xmax = 80 + 220, ymax = 50 + 320 for df_train_new that matches df_train_too_small</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_new.loc[df_train_new[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">].</span><span class="mtk3">isin</span><span class="mtk1">(df_train_too_small[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">]), </span><span class="mtk6">&quot;xmin&quot;</span><span class="mtk1">] </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">80.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_new.loc[df_train_new[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">].</span><span class="mtk3">isin</span><span class="mtk1">(df_train_too_small[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">]), </span><span class="mtk6">&quot;ymin&quot;</span><span class="mtk1">] </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">50.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_new.loc[df_train_new[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">].</span><span class="mtk3">isin</span><span class="mtk1">(df_train_too_small[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">]), </span><span class="mtk6">&quot;xmax&quot;</span><span class="mtk1">] </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">80.0</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">220.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_new.loc[df_train_new[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">].</span><span class="mtk3">isin</span><span class="mtk1">(df_train_too_small[</span><span class="mtk6">&quot;image_file_path&quot;</span><span class="mtk1">]), </span><span class="mtk6">&quot;ymax&quot;</span><span class="mtk1">] </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">50.0</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk7">320.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki"># save fixed information</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">df_train_new.</span><span class="mtk3">to_csv</span><span class="mtk1">(</span><span class="mtk6">&#39;./train_images.csv&#39;</span><span class="mtk1">, </span><span class="mtk4 mtki">index</span><span class="mtk8">=</span><span class="mtk7">False</span><span class="mtk1">)</span></span></span></code></pre>
</li>
<li>Same process of detecting &#x26; cropping facial information was applied on the evaluation image dataset.</li>
</ul>
<h2 id="other-teammates-ideas--contributions" style="position:relative;"><a href="#other-teammates-ideas--contributions" aria-label="other teammates ideas  contributions permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other teammate's ideas &#x26; contributions</h2>
<h3 id="1-applying-stratified-k-fold" style="position:relative;"><a href="#1-applying-stratified-k-fold" aria-label="1 applying stratified k fold permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Applying Stratified K-fold</h3>
<p>One thing to note is that stratified K-fold should have stopped more or less at 2nd or 3rd fold. After then, the model has already seen both the train and test set, therefore the further training should be halted.</p>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> sklearn.model_selection </span><span class="mtk10 mtki">import</span><span class="mtk1"> KFold , StratifiedKFold</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">for</span><span class="mtk1"> epoch </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">10</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_loss </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_val_loss </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_val_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_class_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_class_val_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_mask_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_mask_val_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_gender_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_gender_val_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_age_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    epoch_age_val_acc </span><span class="mtk8">=</span><span class="mtk1"> [[] </span><span class="mtk10 mtki">for</span><span class="mtk1"> i </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(</span><span class="mtk7">18</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    stratified_kfold </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">StratifiedKFold</span><span class="mtk1">(</span><span class="mtk4 mtki">n_splits</span><span class="mtk8">=</span><span class="mtk7">5</span><span class="mtk1">, </span><span class="mtk4 mtki">shuffle</span><span class="mtk8">=</span><span class="mtk7">True</span><span class="mtk1">, </span><span class="mtk4 mtki">random_state</span><span class="mtk8">=</span><span class="mtk7">None</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    k_idx </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10 mtki">for</span><span class="mtk1"> train_index, validate_index </span><span class="mtk10">in</span><span class="mtk1"> stratified_kfold.</span><span class="mtk3">split</span><span class="mtk1">(np.</span><span class="mtk3">zeros</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(train_ages)), train_ages):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk10">f</span><span class="mtk6">&#39;## Stratified_K-Fold :: </span><span class="mtk7">{</span><span class="mtk1">k_idx</span><span class="mtk7">}</span><span class="mtk6">&#39;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        k_idx </span><span class="mtk8">+=</span><span class="mtk1"> </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        train_dataset </span><span class="mtk8">=</span><span class="mtk1"> torch.utils.data.dataset.</span><span class="mtk3">Subset</span><span class="mtk1">(dataset, train_index)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        valid_dataset </span><span class="mtk8">=</span><span class="mtk1"> torch.utils.data.dataset.</span><span class="mtk3">Subset</span><span class="mtk1">(dataset, validate_index)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        valid_dataset </span><span class="mtk8">=</span><span class="mtk1"> copy.</span><span class="mtk3">deepcopy</span><span class="mtk1">(valid_dataset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        valid_dataset.dataset.transform </span><span class="mtk8">=</span><span class="mtk1"> transform_val</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        train_loader </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">DataLoader</span><span class="mtk1">(train_dataset,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">batch_size</span><span class="mtk8">=</span><span class="mtk7">32</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">shuffle</span><span class="mtk8">=</span><span class="mtk7">True</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">num_workers</span><span class="mtk8">=</span><span class="mtk7">0</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">drop_last</span><span class="mtk8">=</span><span class="mtk7">True</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                   )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        val_loader </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">DataLoader</span><span class="mtk1">(valid_dataset,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">batch_size</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">32</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">shuffle</span><span class="mtk8">=</span><span class="mtk7">True</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk4 mtki">num_workers</span><span class="mtk8">=</span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                   )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">for</span><span class="mtk1"> i, data </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk3">tqdm</span><span class="mtk1">(</span><span class="mtk8">enumerate</span><span class="mtk1">(train_loader), </span><span class="mtk4 mtki">desc</span><span class="mtk8">=</span><span class="mtk10">f</span><span class="mtk6">&quot;epoch-</span><span class="mtk7">{</span><span class="mtk1">epoch</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1">, </span><span class="mtk4 mtki">total</span><span class="mtk8">=len</span><span class="mtk1">(train_loader)):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            inputs, (labels, masks, genders, ages) </span><span class="mtk8">=</span><span class="mtk1"> data</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            optimizer.</span><span class="mtk3">zero_grad</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            outputs_mask, outputs_gender, outputs_age </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">model</span><span class="mtk1">(inputs)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            outputs_label </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_labels</span><span class="mtk1">(outputs_mask, outputs_gender, outputs_age, device)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            loss_masks </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">criterion</span><span class="mtk1">(outputs_mask, masks)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            loss_genders </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">criterion</span><span class="mtk1">(outputs_gender, genders)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            loss_ages </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">criterion</span><span class="mtk1">(outputs_age, ages)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            loss </span><span class="mtk8">=</span><span class="mtk1"> loss_masks </span><span class="mtk8">+</span><span class="mtk1"> loss_genders </span><span class="mtk8">+</span><span class="mtk1"> loss_ages</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            epoch_loss </span><span class="mtk8">+=</span><span class="mtk1"> loss</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_acc</span><span class="mtk1">(outputs_label, labels)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            epoch_acc </span><span class="mtk8">+=</span><span class="mtk1"> acc</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            epoch_class_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc</span><span class="mtk1">(outputs_label, labels, epoch_class_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            epoch_mask_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc_mask</span><span class="mtk1">(outputs_mask, masks, epoch_mask_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            epoch_gender_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc_gender</span><span class="mtk1">(outputs_gender, genders, epoch_gender_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            epoch_age_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc_age</span><span class="mtk1">(outputs_age, ages, epoch_age_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            loss.</span><span class="mtk3">backward</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            optimizer.</span><span class="mtk3">step</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            scheduler.</span><span class="mtk3">step</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">with</span><span class="mtk1"> torch.</span><span class="mtk3">no_grad</span><span class="mtk1">():</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10 mtki">for</span><span class="mtk1"> i, data </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">enumerate</span><span class="mtk1">(val_loader):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_inputs, (val_labels, val_masks, val_genders, val_ages) </span><span class="mtk8">=</span><span class="mtk1"> data</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_outputs_mask, val_outputs_gender, val_outputs_age </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">model</span><span class="mtk1">(val_inputs)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_outputs_label </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_labels</span><span class="mtk1">(val_outputs_mask, val_outputs_gender, val_outputs_age, device)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_loss_mask </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">criterion</span><span class="mtk1">(val_outputs_mask, val_masks)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_loss_gender </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">criterion</span><span class="mtk1">(val_outputs_gender, val_genders)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_loss_age </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">criterion</span><span class="mtk1">(val_outputs_age, val_ages)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_loss </span><span class="mtk8">=</span><span class="mtk1"> val_loss_mask </span><span class="mtk8">+</span><span class="mtk1"> val_loss_gender </span><span class="mtk8">+</span><span class="mtk1"> val_loss_age</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                epoch_val_loss </span><span class="mtk8">+=</span><span class="mtk1"> val_loss</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                val_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_acc</span><span class="mtk1">(val_outputs_label, val_labels)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                epoch_val_acc </span><span class="mtk8">+=</span><span class="mtk1"> val_acc</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                epoch_class_val_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc</span><span class="mtk1">(val_outputs_label, val_labels, epoch_class_val_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                epoch_mask_val_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc_mask</span><span class="mtk1">(val_outputs_mask, val_masks, epoch_mask_val_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                epoch_gender_val_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc_gender</span><span class="mtk1">(val_outputs_gender, val_genders, epoch_gender_val_acc)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                epoch_age_val_acc </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">func_class_acc_age</span><span class="mtk1">(val_outputs_age, val_ages, epoch_age_val_acc)</span></span></span></code></pre>
<h3 id="2-applying-out-of-fold-ensemble" style="position:relative;"><a href="#2-applying-out-of-fold-ensemble" aria-label="2 applying out of fold ensemble permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Applying Out-of-fold Ensemble</h3>
<p>I believed that ensemble won't improve the model's performance, but it did! Teammates has tried both the hard voting ensemble(counting discrete integer of labels) and soft voting ensemble(summing predicted probabilities). We adapted soft voting as the favorable approach.</p>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model_path </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/content/v4_stkfold5_epoch3_transformer_2th_000_loss_0.12.ckpt&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model1 </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">MyModel</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model1.</span><span class="mtk3">load_state_dict</span><span class="mtk1">(torch.</span><span class="mtk3">load</span><span class="mtk1">(model_path))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model1.</span><span class="mtk3">cuda</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model_path </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/content/v4_stkfold5_epoch3_transformer_3th_000_loss_0.033.ckpt&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model2 </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">MyModel</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model2.</span><span class="mtk3">load_state_dict</span><span class="mtk1">(torch.</span><span class="mtk3">load</span><span class="mtk1">(model_path))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model2.</span><span class="mtk3">cuda</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model_path </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/content/v4_stkfold5_epoch3_transformer_3th_001_loss_0.033.ckpt&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model3 </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">MyModel</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model3.</span><span class="mtk3">load_state_dict</span><span class="mtk1">(torch.</span><span class="mtk3">load</span><span class="mtk1">(model_path))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model3.</span><span class="mtk3">cuda</span><span class="mtk1">()</span></span></span></code></pre>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> torch.utils.data </span><span class="mtk10 mtki">import</span><span class="mtk1"> Dataset, DataLoader</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">class</span><span class="mtk1"> </span><span class="mtk11">TestDataset</span><span class="mtk1">(</span><span class="mtk11">Dataset</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk8">__init__</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">, </span><span class="mtk7 mtki">img_paths</span><span class="mtk1">, </span><span class="mtk7 mtki">transform</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.img_paths </span><span class="mtk8">=</span><span class="mtk1"> img_paths</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.transform </span><span class="mtk8">=</span><span class="mtk1"> transform</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk8">__getitem__</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">, </span><span class="mtk7 mtki">index</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        image </span><span class="mtk8">=</span><span class="mtk1"> Image.</span><span class="mtk3">open</span><span class="mtk1">(</span><span class="mtk11">self</span><span class="mtk1">.img_paths[index])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">if</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.transform:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            image </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.</span><span class="mtk3">transform</span><span class="mtk1">(image)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">return</span><span class="mtk1"> image, </span><span class="mtk11">self</span><span class="mtk1">.img_paths[index]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk8">__len__</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">return</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk11">self</span><span class="mtk1">.img_paths)</span></span></span></code></pre>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">from</span><span class="mtk1"> torchvision </span><span class="mtk10 mtki">import</span><span class="mtk1"> transforms</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">TEST_DIR</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;/content/input/data/eval&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">submission </span><span class="mtk8">=</span><span class="mtk1"> pd.</span><span class="mtk3">read_csv</span><span class="mtk1">(os.path.</span><span class="mtk3">join</span><span class="mtk1">(</span><span class="mtk7">TEST_DIR</span><span class="mtk1">, </span><span class="mtk6">&#39;info.csv&#39;</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">image_dir </span><span class="mtk8">=</span><span class="mtk1"> os.path.</span><span class="mtk3">join</span><span class="mtk1">(</span><span class="mtk7">TEST_DIR</span><span class="mtk1">, </span><span class="mtk6">&#39;images&#39;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">image_paths </span><span class="mtk8">=</span><span class="mtk1"> [os.path.</span><span class="mtk3">join</span><span class="mtk1">(image_dir, img_id) </span><span class="mtk10 mtki">for</span><span class="mtk1"> img_id </span><span class="mtk10">in</span><span class="mtk1"> submission.ImageID]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">valid_transform </span><span class="mtk8">=</span><span class="mtk1"> transforms.</span><span class="mtk3">Compose</span><span class="mtk1">([</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    transforms.</span><span class="mtk3">CenterCrop</span><span class="mtk1">((</span><span class="mtk7">400</span><span class="mtk1">,</span><span class="mtk7">200</span><span class="mtk1">)),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    transforms.</span><span class="mtk3">ToTensor</span><span class="mtk1">(),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    transforms.</span><span class="mtk3">Normalize</span><span class="mtk1">((</span><span class="mtk7">0.56019358</span><span class="mtk1">, </span><span class="mtk7">0.52410121</span><span class="mtk1">, </span><span class="mtk7">0.501457</span><span class="mtk1">), (</span><span class="mtk7">0.23318603</span><span class="mtk1">, </span><span class="mtk7">0.24300033</span><span class="mtk1">, </span><span class="mtk7">0.24567522</span><span class="mtk1">)),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">dataset </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">TestDataset</span><span class="mtk1">(image_paths, valid_transform)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">loader </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">DataLoader</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    dataset,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4 mtki">shuffle</span><span class="mtk8">=</span><span class="mtk7">False</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">device </span><span class="mtk8">=</span><span class="mtk1"> torch.</span><span class="mtk3">device</span><span class="mtk1">(</span><span class="mtk6">&#39;cuda&#39;</span><span class="mtk1">)</span></span></span></code></pre>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model1.</span><span class="mtk3">eval</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model2.</span><span class="mtk3">eval</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">model3.</span><span class="mtk3">eval</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">pred_result </span><span class="mtk8">=</span><span class="mtk1"> []</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">all_predictions </span><span class="mtk8">=</span><span class="mtk1"> []</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10 mtki">for</span><span class="mtk1"> images, path </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk3">tqdm</span><span class="mtk1">(loader):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    temp </span><span class="mtk8">=</span><span class="mtk1"> []</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    temp.</span><span class="mtk3">append</span><span class="mtk1">(path)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10 mtki">with</span><span class="mtk1"> torch.</span><span class="mtk3">no_grad</span><span class="mtk1">():</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        images </span><span class="mtk8">=</span><span class="mtk1"> images.</span><span class="mtk3">type</span><span class="mtk1">(torch.FloatTensor).</span><span class="mtk3">to</span><span class="mtk1">(device)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        pred1 </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">model1</span><span class="mtk1">(images)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        pred2 </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">model2</span><span class="mtk1">(images)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        pred3 </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">model3</span><span class="mtk1">(images)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        pred </span><span class="mtk8">=</span><span class="mtk1"> (pred1 </span><span class="mtk8">+</span><span class="mtk1"> pred2 </span><span class="mtk8">+</span><span class="mtk1"> pred3)</span><span class="mtk8">/</span><span class="mtk7">3</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        pred </span><span class="mtk8">=</span><span class="mtk1"> pred.</span><span class="mtk3">argmax</span><span class="mtk1">(</span><span class="mtk4 mtki">dim</span><span class="mtk8">=-</span><span class="mtk7">1</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        temp.</span><span class="mtk3">append</span><span class="mtk1">(pred)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        all_predictions.</span><span class="mtk3">extend</span><span class="mtk1">(pred.</span><span class="mtk3">cpu</span><span class="mtk1">().</span><span class="mtk3">numpy</span><span class="mtk1">())</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    pred_result.</span><span class="mtk3">append</span><span class="mtk1">(temp)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">submission[</span><span class="mtk6">&#39;ans&#39;</span><span class="mtk1">] </span><span class="mtk8">=</span><span class="mtk1"> all_predictions</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">PRETRAINED_MODEL_NAME</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&quot;eff_b4_stkkfold_v4_kfold_arcface&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">file_name </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">f</span><span class="mtk6">&quot;</span><span class="mtk7">{PRETRAINED_MODEL_NAME}</span><span class="mtk6">_submission.csv&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">submission.</span><span class="mtk3">to_csv</span><span class="mtk1">(os.path.</span><span class="mtk3">join</span><span class="mtk1">(</span><span class="mtk7">TEST_DIR</span><span class="mtk1">, file_name), </span><span class="mtk4 mtki">index</span><span class="mtk8">=</span><span class="mtk7">False</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk6">&#39;test inference is done!&#39;</span><span class="mtk1">)</span></span></span></code></pre>
<h3 id="3-applying-multihead-modeling" style="position:relative;"><a href="#3-applying-multihead-modeling" aria-label="3 applying multihead modeling permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Applying Multihead Modeling</h3>
<p>Rather than approaching the question as 18 classes classification problem, note823 suggested to approach it as multi-labeling problem. However that was too costly both computationaly and development-wise, so attaching 3 independent fully connected layers have done its job.</p>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">class</span><span class="mtk1"> </span><span class="mtk11">MyModel</span><span class="mtk1">(</span><span class="mtk11">nn</span><span class="mtk1">.</span><span class="mtk11">Module</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk8">__init__</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">super</span><span class="mtk1">(MyModel, </span><span class="mtk11">self</span><span class="mtk1">).</span><span class="mtk8">__init__</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.model </span><span class="mtk8">=</span><span class="mtk1"> timm.</span><span class="mtk3">create_model</span><span class="mtk1">(</span><span class="mtk6">&#39;tf_efficientnet_b4&#39;</span><span class="mtk1">, </span><span class="mtk4 mtki">pretrained</span><span class="mtk8">=</span><span class="mtk7">True</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.model.classifier </span><span class="mtk8">=</span><span class="mtk1"> nn.</span><span class="mtk3">Linear</span><span class="mtk1">(</span><span class="mtk7">1792</span><span class="mtk1">, </span><span class="mtk7">1024</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.fc1 </span><span class="mtk8">=</span><span class="mtk1"> nn.</span><span class="mtk3">Linear</span><span class="mtk1">(</span><span class="mtk7">1024</span><span class="mtk1">, </span><span class="mtk7">3</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.fc2 </span><span class="mtk8">=</span><span class="mtk1"> nn.</span><span class="mtk3">Linear</span><span class="mtk1">(</span><span class="mtk7">1024</span><span class="mtk1">, </span><span class="mtk7">2</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">.fc3 </span><span class="mtk8">=</span><span class="mtk1"> nn.</span><span class="mtk3">Linear</span><span class="mtk1">(</span><span class="mtk7">1024</span><span class="mtk1">, </span><span class="mtk7">3</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk3">forward</span><span class="mtk1">(</span><span class="mtk11 mtki">self</span><span class="mtk1">, </span><span class="mtk7 mtki">x</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        fc_output </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.</span><span class="mtk3">model</span><span class="mtk1">(x)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        mask </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.</span><span class="mtk3">fc1</span><span class="mtk1">(fc_output)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        gender </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.</span><span class="mtk3">fc2</span><span class="mtk1">(fc_output)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        age </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1">.</span><span class="mtk3">fc3</span><span class="mtk1">(fc_output)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10 mtki">return</span><span class="mtk1"> mask, gender, age</span></span></span></code></pre>
<p>Ever since the beginning, note823 has been attaching two fully connected layers to the backbone classifier. I was wondering why, but it was later figured out that having another fully connected layer at the end enabled the model to capture the hidden feature of the image.</p>
<h2 id="other-insights" style="position:relative;"><a href="#other-insights" aria-label="other insights permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other insights</h2>
<ul>
<li>Validation Loss the was important KPI compared to validation accuracy or validation f1 score. There were some attempts that fixing individual's id for the train dataset and validation dataset to compare model's performance, but I thought this attempt might degrad the randomization of dataset allocation.</li>
<li>Spending more time on label correction for the train dataset would have improved the accuracy. It was later found that more or less than 100 labels out of 18900 data was wrong.</li>
<li>validation dataloader shuffle set to False does affect to the model's performance</li>
<li><strong>Visualization mattered a lot.</strong> It was essential to check the model's performance. Checking labels as such code enabled the model has been evaluated properly or not.</li>
</ul>
<pre class="grvsc-container one-dark-pro" data-language="python" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">def</span><span class="mtk1"> </span><span class="mtk3">show_images</span><span class="mtk1">(</span><span class="mtk7 mtki">pred_result_iter</span><span class="mtk1">, </span><span class="mtk7 mtki">n</span><span class="mtk1">=</span><span class="mtk7">5</span><span class="mtk1">, </span><span class="mtk7 mtki">rows</span><span class="mtk1"> = </span><span class="mtk7">1</span><span class="mtk1">, </span><span class="mtk7 mtki">cols</span><span class="mtk1"> = </span><span class="mtk7">5</span><span class="mtk1">, </span><span class="mtk7 mtki">title</span><span class="mtk1"> = </span><span class="mtk6">&#39;Default&#39;</span><span class="mtk1">):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  plt.</span><span class="mtk3">figure</span><span class="mtk1">(</span><span class="mtk4 mtki">figsize</span><span class="mtk8">=</span><span class="mtk1">(</span><span class="mtk7">16</span><span class="mtk1">,</span><span class="mtk7">10</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  plt.</span><span class="mtk3">suptitle</span><span class="mtk1">(title, </span><span class="mtk4 mtki">fontsize</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">16</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk10 mtki">for</span><span class="mtk1"> k </span><span class="mtk10">in</span><span class="mtk1"> </span><span class="mtk8">range</span><span class="mtk1">(n):</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    img, label </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">next</span><span class="mtk1">(pred_result_iter)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    label </span><span class="mtk8">=</span><span class="mtk1"> label.</span><span class="mtk3">cpu</span><span class="mtk1">().</span><span class="mtk3">numpy</span><span class="mtk1">()[</span><span class="mtk7">0</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    img </span><span class="mtk8">=</span><span class="mtk1"> Image.</span><span class="mtk3">open</span><span class="mtk1">(img[</span><span class="mtk7">0</span><span class="mtk1">])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    plt.</span><span class="mtk3">subplot</span><span class="mtk1">(rows, cols, k</span><span class="mtk8">+</span><span class="mtk7">1</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    plt.</span><span class="mtk3">imshow</span><span class="mtk1">(img)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    plt.</span><span class="mtk3">axis</span><span class="mtk1">(</span><span class="mtk6">&#39;off&#39;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    plt.</span><span class="mtk3">title</span><span class="mtk1">(</span><span class="mtk6">&quot;label:</span><span class="mtk7">%s</span><span class="mtk6">&quot;</span><span class="mtk8">%</span><span class="mtk1">(label))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">pred_result_iter </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk8">iter</span><span class="mtk1">(pred_result)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">show_images</span><span class="mtk1">(pred_result_iter, </span><span class="mtk4 mtki">n</span><span class="mtk8">=</span><span class="mtk7">50</span><span class="mtk1">, </span><span class="mtk4 mtki">rows</span><span class="mtk8">=</span><span class="mtk7">5</span><span class="mtk1">, </span><span class="mtk4 mtki">cols</span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">10</span><span class="mtk1">, </span><span class="mtk4 mtki">title</span><span class="mtk8">=</span><span class="mtk6">&#39;Test Sample&#39;</span><span class="mtk1">)</span></span></span></code></pre>
<h2 id="should-have" style="position:relative;"><a href="#should-have" aria-label="should have permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Should have?</h2>
<ul>
<li>Checking the original label of the dataset should be prioritized rather than attaching the foreign dataset. <a href="https://github.com/jinmang2/boostcamp_ai_tech_2/blob/main/assets/ppt/palettai.pdf">Team 8 was impressive in terms of using 5-fold trained BEiT models to predict the out-of-folds, check the conflicting votes which is regarded as wrong label.</a></li>
</ul>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .one-dark-pro {
    background-color: #282c34;
    color: #abb2bf;
  }
  .one-dark-pro .mtki { font-style: italic; }
  .one-dark-pro .mtk10 { color: #C678DD; }
  .one-dark-pro .mtk1 { color: #ABB2BF; }
  .one-dark-pro .mtk11 { color: #E5C07B; }
  .one-dark-pro .mtk8 { color: #56B6C2; }
  .one-dark-pro .mtk7 { color: #D19A66; }
  .one-dark-pro .mtk6 { color: #98C379; }
  .one-dark-pro .mtk3 { color: #61AFEF; }
  .one-dark-pro .mtk4 { color: #E06C75; }
  .one-dark-pro .mtk5 { color: #7F848E; }
  .one-dark-pro .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></div><div class="css-1bdwg0l eyldt480"><div><style data-emotion-css="17t5ffy">.css-17t5ffy{margin-top:1rem;margin-bottom:1rem;}</style><div class="css-17t5ffy"><div class="css-1l4w6pd"><div class="css-yapsbb"></div></div></div><style data-emotion-css="i1cgbm">.css-i1cgbm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;margin-top:1rem;padding-left:0.5rem;padding-right:0.5rem;}</style><div class="css-i1cgbm"><style data-emotion-css="9nr5sz">.css-9nr5sz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#1CA1F2;}</style><button class="css-9nr5sz"><style data-emotion-css="u7tj59">.css-u7tj59{fill:currentColor;margin-top:auto;margin-bottom:auto;margin-right:0.25rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>Share with <!-- -->Twitter</button><style data-emotion-css="rk0yc0">.css-rk0yc0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#6E7783;}</style><button class="css-rk0yc0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg>Share with <!-- -->URL</button></div></div></div></div></div><div class="css-1bdwg0l eyldt480"><style data-emotion-css="17t1oy1">.css-17t1oy1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap-reverse;-ms-flex-wrap:wrap-reverse;flex-wrap:wrap-reverse;margin-left:0.5rem;margin-right:0.5rem;margin-top:1rem;}@media (min-width:768px){.css-17t1oy1{-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}}</style><div class="css-17t1oy1 e816y8n0"><style data-emotion-css="1pwr1ry">.css-1pwr1ry{width:100%;margin:0.5rem;}@media (min-width:768px){.css-1pwr1ry{width:50%;margin:1rem;}}</style><div class="css-1pwr1ry e816y8n1"><style data-emotion-css="vl2eok">.css-vl2eok{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);text-align:left;width:100%;height:100%;padding:0.5rem;background-color:#eee;border-radius:0.25rem;border-left-width:4px;border-color:#86a8e7;}.css-vl2eok:hover{background-color:#ddd;}</style><a rel="prev" class="css-vl2eok" href="/DL&amp;ML/List-of-My-Questions/"><style data-emotion-css="19o7xeo">.css-19o7xeo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;margin-right:1rem;margin-left:0.5rem;height:100%;}</style><div class="css-19o7xeo"><style data-emotion-css="11za1ik">.css-11za1ik{width:2rem;height:2rem;margin-top:auto;margin-bottom:auto;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-11za1ik" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 0 0 0 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"></path></svg></div><style data-emotion-css="v38or">.css-v38or{display:inline-block;margin-top:0.5rem;margin-bottom:0.5rem;}</style><div class="css-v38or"><style data-emotion-css="2m7hin">.css-2m7hin{color:#3737B9;}</style><p class="css-2m7hin">Previous Post</p><p>List of Unnoticed Questions</p></div></a></div><div class="css-1pwr1ry e816y8n1"><style data-emotion-css="xhvfnc">.css-xhvfnc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);text-align:right;width:100%;height:100%;padding:0.5rem;background-color:#eee;border-radius:0.25rem;border-right-width:4px;border-color:#86a8e7;}.css-xhvfnc:hover{background-color:#ddd;}</style><a rel="next" class="css-xhvfnc" href="/DL&amp;ML/NLP-Clipboard/"><div class="css-v38or"><p class="css-2m7hin">Next Post</p><p>NLP Clipboard</p></div><div class="css-19o7xeo"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-11za1ik" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 0 0 0-48.4z"></path></svg></div></a></div></div><style data-emotion-css="14yohw7">.css-14yohw7{width:100%;max-width:768px;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto;padding-top:2rem;margin-top:0.5rem;margin-bottom:1rem;}@media (min-width:768px){.css-14yohw7{padding-left:0;padding-right:0;padding-top:3rem;}}</style><div class="css-14yohw7 e16bs3iv0"><style data-emotion-css="180ky7f">.css-180ky7f{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:0.5rem;padding-right:0.5rem;}@media (min-width:768px){.css-180ky7f{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-180ky7f e16bs3iv1"><style data-emotion-css="p5b1u1">.css-p5b1u1{border-radius:9999px;border-width:1px;--border-opacity:1;border-color:rgba(214,188,250,var(--border-opacity));margin-right:2rem;margin-bottom:0.5rem;}@media (min-width:768px){.css-p5b1u1{margin-bottom:1rem;}}</style><div class="css-p5b1u1 gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:128px;height:128px"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQBBf/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABynZIqtSk4c5qdwD/AP/EABgQAAMBAQAAAAAAAAAAAAAAAAABAgMR/9oACAEBAAEFApTIkuNHXZgjWK2bZvTM6b1P/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPwFiK//EABURAQEAAAAAAAAAAAAAAAAAAAEg/9oACAECAQE/ASP/xAAdEAACAQQDAAAAAAAAAAAAAAAAASECEBFRIjGB/9oACAEBAAY/AvCZ2QoMsw5TOJ2Up7t//8QAHRAAAgICAwEAAAAAAAAAAAAAAAERIUFhMVFxkf/aAAgBAQABPyGQ1UIIVo1dtoaHoXgWF10MklGMEvhCEYta+DAJgvw//9oADAMBAAIAAwAAABBYODz/xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhQf/aAAgBAwEBPxB279ksrt//xAAXEQEBAQEAAAAAAAAAAAAAAAABABAx/9oACAECAQE/EI9kM//EAB4QAQEAAgICAwAAAAAAAAAAAAERACFRYTFBoeHw/9oACAEBAAE/ENiSENW+VTiZpVWrCLvvKMeEnTGARaXZevjBBRTTtdPnjWuccCRSa1+JjqKA/TCoCwoW324ixDPbn//Z" alt="profileImg" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/584d7a912ca03da16698aea724815677/6dc0c/profile.jpg 1x,
/static/584d7a912ca03da16698aea724815677/cc017/profile.jpg 1.5x,
/static/584d7a912ca03da16698aea724815677/0c30b/profile.jpg 2x" /><img loading="lazy" width="128" height="128" srcset="/static/584d7a912ca03da16698aea724815677/6dc0c/profile.jpg 1x,
/static/584d7a912ca03da16698aea724815677/cc017/profile.jpg 1.5x,
/static/584d7a912ca03da16698aea724815677/0c30b/profile.jpg 2x" src="/static/584d7a912ca03da16698aea724815677/6dc0c/profile.jpg" alt="profileImg" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div><span>Written by </span><style data-emotion-css="1t4jyca">.css-1t4jyca{display:inline-block;font-size:1.25rem;font-weight:700;border-radius:9999px;margin-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem;--bg-opacity:1;background-color:rgba(237,242,247,var(--bg-opacity));color:#3737B9;}</style><p class="css-1t4jyca"><a class="author-name-content" href="/about"><span>@<!-- -->Young Jin Ahn</span></a></p><style data-emotion-css="vg2p6i">.css-vg2p6i{font-size:0.875rem;font-weight:400;margin-bottom:0.5rem;}</style><div class="css-vg2p6i">break, compose, display</div></div></div><style data-emotion-css="1air669">.css-1air669{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-left:0.5rem;margin-right:0.5rem;}</style><div class="css-1air669"><div class="css-yapsbb"></div></div><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><a title="github Link" href="https://github.com/snoop2head" class="css-1baulvz"><style data-emotion-css="vnd1fq">.css-vnd1fq{width:2rem;height:2rem;margin-top:1rem;margin-left:1rem;-webkit-transition:all 300ms cubic-bezier(0,0,0.2,1);transition:all 300ms cubic-bezier(0,0,0.2,1);color:#888;}.css-vnd1fq:hover{color:#000;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="css-vnd1fq" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a title="facebook Link" href="https://www.facebook.com/profile.php?id=100009133042568" class="css-1baulvz"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-vnd1fq" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a></div><style data-emotion-css="18jj1tc">.css-18jj1tc{margin-top:1.25rem;margin-left:0.5rem;margin-right:0.5rem;}</style><div class="css-18jj1tc"><div class="utterances"></div></div></div></div><style data-emotion-css="xgi74q">.css-xgi74q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:fixed;bottom:0;right:0;padding-right:1.5rem;padding-bottom:1.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><div class="css-xgi74q e8huvi00"><style data-emotion-css="1a68u">.css-1a68u{box-shadow:0 2px 2px 0 rgba(0,0,0,0.15);-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#636363;font-size:0.75rem;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:9999px;--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;-webkit-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));-ms-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-content:flex-end;-ms-flex-line-pack:end;align-content:flex-end;z-index:100;}.css-1a68u:hover{background-color:#404040;color:#FFFFFF;}.css-1a68u:hover{--transform-scale-x:1.05;--transform-scale-y:1.05;}</style><button title="change to darkmode" class="css-1a68u"><style data-emotion-css="1alqh2e">.css-1alqh2e{fill:currentColor;--text-opacity:1;color:rgba(246,224,94,var(--text-opacity));width:1rem;height:1rem;margin-top:auto;margin-bottom:auto;margin-left:0;margin-right:0;}@media (min-width:768px){.css-1alqh2e{display:inline-block;margin-left:0.25rem;margin-right:0.25rem;}}</style><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1alqh2e" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg><style data-emotion-css="flxr9x">.css-flxr9x{display:none;margin-right:0;}@media (min-width:768px){.css-flxr9x{display:inline-block;margin-right:0.25rem;}}</style><span class="css-flxr9x">Use Dark Mode</span></button><style data-emotion-css="15afv4q">.css-15afv4q{box-shadow:0 2px 2px 0 rgba(0,0,0,0.15);-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#636363;font-size:0.75rem;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:9999px;--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;-webkit-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));-ms-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));cursor:pointer;margin-left:0.5rem;margin-top:auto;margin-bottom:auto;z-index:100;}.css-15afv4q:hover{background-color:#404040;color:#FFFFFF;}.css-15afv4q:hover{--transform-scale-x:1.05;--transform-scale-y:1.05;}</style><button title="top page" class="css-15afv4q"><style data-emotion-css="13htjwu">.css-13htjwu{width:1rem;height:1rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-13htjwu" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M868 545.5L536.1 163a31.96 31.96 0 0 0-48.3 0L156 545.5a7.97 7.97 0 0 0 6 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"></path></svg></button></div><style data-emotion-css="1k8xcyw">.css-1k8xcyw{text-align:center;padding-top:2rem;padding-bottom:2rem;bottom:0;}</style><footer class="css-1k8xcyw"><style data-emotion-css="1xju3od">.css-1xju3od{font-size:0.75rem;font-weight:700;}</style><a href="https://github.com/snoop2head" class="css-1xju3od">Â©snoop2head</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-186254784-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/DL&ML/Mask-Age-Gender-Classification-Competition/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-efbe87ab08854460e1b4.js"],"app":["/app-6b37a0275bc86b56e034.js"],"component---src-pages-404-js":["/component---src-pages-404-js-23314e5a1122284127b1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-78029fb8e6dade72d83f.js"],"component---src-pages-index-js":["/component---src-pages-index-js-81659046284b3feb90f5.js"],"component---src-pages-search-js":["/component---src-pages-search-js-6bfc09fa0dcf8ea3b63d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-5f317a7779dd1baa19f9.js"],"component---src-templates-category-js":["/component---src-templates-category-js-5fbfac713624a9c1ac35.js"]};/*]]>*/</script><script src="/polyfill-efbe87ab08854460e1b4.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-5f317a7779dd1baa19f9.js" async=""></script><script src="/7a297f752dcfe258c0b0106d89edb3a916af916e-d921dc7587d10ed55da7.js" async=""></script><script src="/b1bda0e5b3305dd279ac60c39e10b0f82af56c10-cca622a04473b7e5e8b2.js" async=""></script><script src="/commons-33df4d3f9aa201d0ec4c.js" async=""></script><script src="/1bfc9850-103202d7f810115a42e7.js" async=""></script><script src="/5e2a4920-da90abce4a08c86a094c.js" async=""></script><script src="/d7eeaac4-dcbe97e7a5aa158c9d08.js" async=""></script><script src="/app-6b37a0275bc86b56e034.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-4121d07143daec1f6e61.js" async=""></script><script src="/styles-e8fd4555a67a3390b64e.js" async=""></script><script src="/framework-c8d3a5345e3f321d7da5.js" async=""></script><script src="/webpack-runtime-2d2e6eca74f66222a671.js" async=""></script></body></html>